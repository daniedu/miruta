(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,24687,e=>{"use strict";e.s(["Textarea",()=>o]);var t=e.i(78196),i=e.i(80064);function o(e){let{className:o,...r}=e;return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),...r})}},93479,99375,e=>{"use strict";e.s(["Input",()=>o],93479);var t=e.i(78196),i=e.i(80064);function o(e){let{className:o,type:r,...s}=e;return(0,t.jsx)("input",{type:r,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",o),...s})}e.s(["Switch",()=>P],99375);var r=e.i(49430),s=e.i(91967),n=e.i(86350),a=e.i(92104),l=e.i(40738),d=e.i(42281),c=e.i(58142),h="Switch",[u,p]=(0,a.createContextScope)(h),[g,m]=u(h),y=r.forwardRef((e,i)=>{let{__scopeSwitch:o,name:a,checked:d,defaultChecked:u,required:p,disabled:m,value:y="on",onCheckedChange:f,form:v,...P}=e,[b,I]=r.useState(null),M=(0,n.useComposedRefs)(i,e=>I(e)),w=r.useRef(!1),S=!b||v||!!b.closest("form"),[E,j]=(0,l.useControllableState)({prop:d,defaultProp:null!=u&&u,onChange:f,caller:h});return(0,t.jsxs)(g,{scope:o,checked:E,disabled:m,children:[(0,t.jsx)(c.Primitive.button,{type:"button",role:"switch","aria-checked":E,"aria-required":p,"data-state":C(E),"data-disabled":m?"":void 0,disabled:m,value:y,...P,ref:M,onClick:(0,s.composeEventHandlers)(e.onClick,e=>{j(e=>!e),S&&(w.current=e.isPropagationStopped(),w.current||e.stopPropagation())})}),S&&(0,t.jsx)(x,{control:b,bubbles:!w.current,name:a,value:y,checked:E,required:p,disabled:m,form:v,style:{transform:"translateX(-100%)"}})]})});y.displayName=h;var f="SwitchThumb",v=r.forwardRef((e,i)=>{let{__scopeSwitch:o,...r}=e,s=m(f,o);return(0,t.jsx)(c.Primitive.span,{"data-state":C(s.checked),"data-disabled":s.disabled?"":void 0,...r,ref:i})});v.displayName=f;var x=r.forwardRef((e,i)=>{let{__scopeSwitch:o,control:s,checked:a,bubbles:l=!0,...c}=e,h=r.useRef(null),u=(0,n.useComposedRefs)(h,i),p=function(e){let t=r.useRef({value:e,previous:e});return r.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(a),g=(0,d.useSize)(s);return r.useEffect(()=>{let e=h.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(p!==a&&t){let i=new Event("click",{bubbles:l});t.call(e,a),e.dispatchEvent(i)}},[p,a,l]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...c,tabIndex:-1,ref:u,style:{...c.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function C(e){return e?"checked":"unchecked"}function P(e){let{className:o,...r}=e;return(0,t.jsx)(y,{"data-slot":"switch",className:(0,i.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",o),...r,children:(0,t.jsx)(v,{"data-slot":"switch-thumb",className:(0,i.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}x.displayName="SwitchBubbleInput"},20125,e=>{"use strict";e.s(["Trash2",()=>t],20125);let t=(0,e.i(54352).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},73443,e=>{"use strict";e.s(["Accordion",()=>ei,"AccordionContent",()=>es,"AccordionItem",()=>eo,"AccordionTrigger",()=>er],73443);var t=e.i(78196),i=e.i(49430),o=e.i(92104),r=e.i(85303),s=e.i(86350),n=e.i(91967),a=e.i(40738),l=e.i(58142),d=e.i(24746),c=e.i(48704),h=e.i(60212),u="Collapsible",[p,g]=(0,o.createContextScope)(u),[m,y]=p(u),f=i.forwardRef((e,o)=>{let{__scopeCollapsible:r,open:s,defaultOpen:n,disabled:d,onOpenChange:c,...p}=e,[g,y]=(0,a.useControllableState)({prop:s,defaultProp:null!=n&&n,onChange:c,caller:u});return(0,t.jsx)(m,{scope:r,disabled:d,contentId:(0,h.useId)(),open:g,onOpenToggle:i.useCallback(()=>y(e=>!e),[y]),children:(0,t.jsx)(l.Primitive.div,{"data-state":I(g),"data-disabled":d?"":void 0,...p,ref:o})})});f.displayName=u;var v="CollapsibleTrigger",x=i.forwardRef((e,i)=>{let{__scopeCollapsible:o,...r}=e,s=y(v,o);return(0,t.jsx)(l.Primitive.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":I(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...r,ref:i,onClick:(0,n.composeEventHandlers)(e.onClick,s.onOpenToggle)})});x.displayName=v;var C="CollapsibleContent",P=i.forwardRef((e,i)=>{let{forceMount:o,...r}=e,s=y(C,e.__scopeCollapsible);return(0,t.jsx)(c.Presence,{present:o||s.open,children:e=>{let{present:o}=e;return(0,t.jsx)(b,{...r,ref:i,present:o})}})});P.displayName=C;var b=i.forwardRef((e,o)=>{let{__scopeCollapsible:r,present:n,children:a,...c}=e,h=y(C,r),[u,p]=i.useState(n),g=i.useRef(null),m=(0,s.useComposedRefs)(o,g),f=i.useRef(0),v=f.current,x=i.useRef(0),P=x.current,b=h.open||u,M=i.useRef(b),w=i.useRef(void 0);return i.useEffect(()=>{let e=requestAnimationFrame(()=>M.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,d.useLayoutEffect)(()=>{let e=g.current;if(e){w.current=w.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();f.current=t.height,x.current=t.width,M.current||(e.style.transitionDuration=w.current.transitionDuration,e.style.animationName=w.current.animationName),p(n)}},[h.open,n]),(0,t.jsx)(l.Primitive.div,{"data-state":I(h.open),"data-disabled":h.disabled?"":void 0,id:h.contentId,hidden:!b,...c,ref:m,style:{"--radix-collapsible-content-height":v?"".concat(v,"px"):void 0,"--radix-collapsible-content-width":P?"".concat(P,"px"):void 0,...e.style},children:b&&a})});function I(e){return e?"open":"closed"}var M=e.i(17279),w="Accordion",S=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[E,j,_]=(0,r.createCollection)(w),[D,k]=(0,o.createContextScope)(w,[_,g]),F=g(),N=i.default.forwardRef((e,i)=>{let{type:o,...r}=e;return(0,t.jsx)(E.Provider,{scope:e.__scopeAccordion,children:"multiple"===o?(0,t.jsx)(R,{...r,ref:i}):(0,t.jsx)(B,{...r,ref:i})})});N.displayName=w;var[O,T]=D(w),[A,L]=D(w,{collapsible:!1}),B=i.default.forwardRef((e,o)=>{let{value:r,defaultValue:s,onValueChange:n=()=>{},collapsible:l=!1,...d}=e,[c,h]=(0,a.useControllableState)({prop:r,defaultProp:null!=s?s:"",onChange:n,caller:w});return(0,t.jsx)(O,{scope:e.__scopeAccordion,value:i.default.useMemo(()=>c?[c]:[],[c]),onItemOpen:h,onItemClose:i.default.useCallback(()=>l&&h(""),[l,h]),children:(0,t.jsx)(A,{scope:e.__scopeAccordion,collapsible:l,children:(0,t.jsx)(U,{...d,ref:o})})})}),R=i.default.forwardRef((e,o)=>{let{value:r,defaultValue:s,onValueChange:n=()=>{},...l}=e,[d,c]=(0,a.useControllableState)({prop:r,defaultProp:null!=s?s:[],onChange:n,caller:w}),h=i.default.useCallback(e=>c(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...t,e]}),[c]),u=i.default.useCallback(e=>c(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t!==e)}),[c]);return(0,t.jsx)(O,{scope:e.__scopeAccordion,value:d,onItemOpen:h,onItemClose:u,children:(0,t.jsx)(A,{scope:e.__scopeAccordion,collapsible:!0,children:(0,t.jsx)(U,{...l,ref:o})})})}),[W,G]=D(w),U=i.default.forwardRef((e,o)=>{let{__scopeAccordion:r,disabled:a,dir:d,orientation:c="vertical",...h}=e,u=i.default.useRef(null),p=(0,s.useComposedRefs)(u,o),g=j(r),m="ltr"===(0,M.useDirection)(d),y=(0,n.composeEventHandlers)(e.onKeyDown,e=>{var t;if(!S.includes(e.key))return;let i=e.target,o=g().filter(e=>{var t;return!(null==(t=e.ref.current)?void 0:t.disabled)}),r=o.findIndex(e=>e.ref.current===i),s=o.length;if(-1===r)return;e.preventDefault();let n=r,a=s-1,l=()=>{(n=r+1)>a&&(n=0)},d=()=>{(n=r-1)<0&&(n=a)};switch(e.key){case"Home":n=0;break;case"End":n=a;break;case"ArrowRight":"horizontal"===c&&(m?l():d());break;case"ArrowDown":"vertical"===c&&l();break;case"ArrowLeft":"horizontal"===c&&(m?d():l());break;case"ArrowUp":"vertical"===c&&d()}null==(t=o[n%s].ref.current)||t.focus()});return(0,t.jsx)(W,{scope:r,disabled:a,direction:d,orientation:c,children:(0,t.jsx)(E.Slot,{scope:r,children:(0,t.jsx)(l.Primitive.div,{...h,"data-orientation":c,ref:p,onKeyDown:a?void 0:y})})})}),z="AccordionItem",[V,Y]=D(z),X=i.default.forwardRef((e,i)=>{let{__scopeAccordion:o,value:r,...s}=e,n=G(z,o),a=T(z,o),l=F(o),d=(0,h.useId)(),c=r&&a.value.includes(r)||!1,u=n.disabled||e.disabled;return(0,t.jsx)(V,{scope:o,open:c,disabled:u,triggerId:d,children:(0,t.jsx)(f,{"data-orientation":n.orientation,"data-state":$(c),...l,...s,ref:i,disabled:u,open:c,onOpenChange:e=>{e?a.onItemOpen(r):a.onItemClose(r)}})})});X.displayName=z;var K="AccordionHeader",H=i.default.forwardRef((e,i)=>{let{__scopeAccordion:o,...r}=e,s=G(w,o),n=Y(K,o);return(0,t.jsx)(l.Primitive.h3,{"data-orientation":s.orientation,"data-state":$(n.open),"data-disabled":n.disabled?"":void 0,...r,ref:i})});H.displayName=K;var q="AccordionTrigger",Z=i.default.forwardRef((e,i)=>{let{__scopeAccordion:o,...r}=e,s=G(w,o),n=Y(q,o),a=L(q,o),l=F(o);return(0,t.jsx)(E.ItemSlot,{scope:o,children:(0,t.jsx)(x,{"aria-disabled":n.open&&!a.collapsible||void 0,"data-orientation":s.orientation,id:n.triggerId,...l,...r,ref:i})})});Z.displayName=q;var J="AccordionContent",Q=i.default.forwardRef((e,i)=>{let{__scopeAccordion:o,...r}=e,s=G(w,o),n=Y(J,o),a=F(o);return(0,t.jsx)(P,{role:"region","aria-labelledby":n.triggerId,"data-orientation":s.orientation,...a,...r,ref:i,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});function $(e){return e?"open":"closed"}Q.displayName=J;let ee=(0,e.i(54352).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var et=e.i(80064);function ei(e){let{...i}=e;return(0,t.jsx)(N,{"data-slot":"accordion",...i})}function eo(e){let{className:i,...o}=e;return(0,t.jsx)(X,{"data-slot":"accordion-item",className:(0,et.cn)("border-b last:border-b-0",i),...o})}function er(e){let{className:i,children:o,...r}=e;return(0,t.jsx)(H,{className:"flex",children:(0,t.jsxs)(Z,{"data-slot":"accordion-trigger",className:(0,et.cn)("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",i),...r,children:[o,(0,t.jsx)(ee,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function es(e){let{className:i,children:o,...r}=e;return(0,t.jsx)(Q,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...r,children:(0,t.jsx)("div",{className:(0,et.cn)("pt-0 pb-4",i),children:o})})}},50658,e=>{"use strict";e.s(["MarkerToolsBar",()=>v],50658);var t=e.i(78196);e.i(49430);var i=e.i(93479),o=e.i(24687),r=e.i(10204),s=e.i(19455),n=e.i(99375),a=e.i(41797),l=e.i(20125),d=e.i(29393),c=e.i(54352);let h=(0,c.default)("list-checks",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]]),u=(0,c.default)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);var p=e.i(24428),g=e.i(2483),m=e.i(73443),y=e.i(13080),f=e.i(21334);let v=e=>{var c;let{className:v=""}=e,x=(0,y.useMapStore)(e=>e.markers.find(t=>t.id===e.activeMarkerId)),C=(0,y.useMapStore)(e=>e.updateMarker),P=(0,y.useMapStore)(e=>e.markerSidebarVisible),b=(0,y.useMapStore)(e=>e.toggleSidebar),I=(e,t)=>{var i;if(!x)return;let o=(null!=(i=x.checklists)?i:[]).map((i,o)=>o===e?t:i);C(x.id,{checklists:o})},M=(0,y.useMapStore)(e=>e.layerSidebarVisible);if(!P)return;if(!x)return(0,t.jsx)("div",{className:"".concat(M?"left-[300px]":"left-4"," absolute top-4 left-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl  text-sm border border-gray-200 max-h-[96vh] max-w-[320px] min-w-[320px] overflow-y-auto z-10"),children:(0,t.jsx)("p",{children:"Crea y Selecciona un Marcador para Empezar a Perzonalizarlo"})});let w=(0,f.getIconComponent)(x.icon);return(0,t.jsxs)("div",{className:"".concat(v," ").concat(M?"left-[300px]":"left-4"," absolute top-4 left-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl  text-sm border border-gray-200 max-h-[96vh] max-w-[320px] min-w-[320px] overflow-y-auto z-10"),children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-between",children:v.length>0?(0,t.jsx)(t.Fragment,{}):(0,t.jsx)(g.XIcon,{onClick:()=>b("marker"),className:"absolute right-2 top-2 w-8 h-8",color:"black"})}),(0,t.jsxs)("div",{className:"flex flex-row gap-4 items-center justify-center my-2 text-2xl border-3 py-2 rounded-2xl",style:{background:x.background,color:x.iconColor},children:[(0,t.jsx)(w,{className:"w-8 h-8"}),x.title]}),(0,t.jsxs)(m.Accordion,{type:"multiple",className:"space-y-2",children:[(0,t.jsxs)(m.AccordionItem,{value:"marcador",children:[(0,t.jsx)(m.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-center align-middle gap-2",children:[(0,t.jsx)(d.Pin,{}),"Informacion"]})}),(0,t.jsxs)(m.AccordionContent,{className:"space-y-3 pt-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(r.Label,{children:"Título"}),(0,t.jsx)(i.Input,{value:x.title||"",onChange:e=>C(x.id,{title:e.target.value}),placeholder:"Ej. Casa principal"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(r.Label,{children:"Descripción"}),(0,t.jsx)(o.Textarea,{value:x.content||"",onChange:e=>C(x.id,{content:e.target.value}),placeholder:"Notas sobre este marcador..."})]})]})]}),(0,t.jsxs)(m.AccordionItem,{value:"apariencia",children:[(0,t.jsx)(m.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-center align-middle gap-2",children:[(0,t.jsx)(u,{}),"Apariencia"]})}),(0,t.jsxs)(m.AccordionContent,{className:"flex flex-col gap-2",children:[(0,t.jsx)(r.Label,{children:"Color del Icono"}),(0,t.jsx)(i.Input,{className:"w-full",type:"color",value:x.iconColor||"#2563EB",onChange:e=>C(x.id,{iconColor:e.target.value})}),(0,t.jsx)(r.Label,{children:"Color del marcador"}),(0,t.jsx)(i.Input,{className:"w-full",type:"color",value:x.background||"#2563EB",onChange:e=>C(x.id,{background:e.target.value})}),(0,t.jsx)(r.Label,{children:"Radio (m)"}),(0,t.jsx)(i.Input,{type:"number",min:0,value:x.radius,onChange:e=>C(x.id,{radius:parseInt(e.target.value)})})]})]}),(0,t.jsxs)(m.AccordionItem,{value:"checklists",children:[(0,t.jsx)(m.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-center align-middle gap-2",children:[(0,t.jsx)(h,{}),"Listas de Tareas"]})}),(0,t.jsxs)(m.AccordionContent,{className:"space-y-4 pt-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Crea listas de tareas para lugares con elementos para llevar o recoger como productos o papeles."}),null==(c=x.checklists)?void 0:c.map((e,o)=>(0,t.jsxs)("div",{className:"rounded-xl border p-3 bg-muted/30 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(i.Input,{value:e.title,onChange:t=>I(o,{...e,title:t.target.value}),placeholder:"Lista de Compras..."}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>(e=>{var t;if(!x)return;let i=null==(t=x.checklists)?void 0:t.filter((t,i)=>i!==e);C(x.id,{checklists:i})})(o),children:(0,t.jsx)(l.Trash2,{className:"w-4 h-4 text-red-500"})})]}),e.items.map((r,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:r.done,onChange:t=>{let i=[...e.items];i[s].done=t.target.checked,I(o,{...e,items:i})}}),(0,t.jsx)(i.Input,{value:r.text,onChange:t=>{let i=[...e.items];i[s].text=t.target.value,I(o,{...e,items:i})},placeholder:"Arroz..."})]},s)),(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>(e=>{var t,i;if(!x)return;let o=[...null!=(t=x.checklists)?t:[]],r=o[e];r&&(o[e]={...r,items:[...null!=(i=r.items)?i:[],{text:"",done:!1}]},C(x.id,{checklists:o}))})(o),className:"w-full mt-2",children:[(0,t.jsx)(a.Plus,{className:"w-4 h-4 mr-1"})," Agregar Elemento"]})]},o)),(0,t.jsxs)(s.Button,{onClick:()=>{x&&C(x.id,{checklists:[...x.checklists||[],{title:"Nueva Lista",items:[]}]})},variant:"secondary",size:"sm",children:[(0,t.jsx)(a.Plus,{className:"w-4 h-4 mr-1"})," Crear lista"]})]})]}),(0,t.jsxs)(m.AccordionItem,{value:"opciones",children:[(0,t.jsx)(m.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-center align-middle gap-2",children:[(0,t.jsx)(p.Settings,{}),"Opciones"]})}),(0,t.jsx)(m.AccordionContent,{className:"space-y-4 pt-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,t.jsx)(r.Label,{children:"Habilitar arrastre"}),(0,t.jsx)(n.Switch,{checked:x.draggable||!1,onCheckedChange:e=>C(x.id,{draggable:e})})]})})]})]})]})}},80961,e=>{"use strict";e.s(["MapPinnedIcon",()=>t],80961);let t=(0,e.i(54352).default)("map-pinned",[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]])},2589,e=>{"use strict";e.s(["TargetIcon",()=>t],2589);let t=(0,e.i(54352).default)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},42880,73885,75410,67815,20336,e=>{"use strict";e.s(["Circle",()=>t.default],42880);var t=e.i(52843);e.s(["Minus",()=>o],73885);var i=e.i(54352);let o=(0,i.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);e.s(["Shapes",()=>r],75410);let r=(0,i.default)("shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);e.s(["Square",()=>s],67815);let s=(0,i.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["CircleDot",()=>n],20336);let n=(0,i.default)("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]])},4026,e=>{"use strict";e.s(["CreateOnMapSideBar",()=>B,"InterestSideBar",()=>L,"NavigateMapSideBar",()=>R,"PublishMapSideBar",()=>W],4026);var t=e.i(78196),i=e.i(13080),o=e.i(23345),r=e.i(54352);let s=(0,r.default)("globe-lock",[["path",{d:"M15.686 15A14.5 14.5 0 0 1 12 22a14.5 14.5 0 0 1 0-20 10 10 0 1 0 9.542 13",key:"qkt0x6"}],["path",{d:"M2 12h8.5",key:"ovaggd"}],["path",{d:"M20 6V4a2 2 0 1 0-4 0v2",key:"1of5e8"}],["rect",{width:"8",height:"5",x:"14",y:"6",rx:"1",key:"1fmf51"}]]);var n=e.i(17989);let a=(0,r.default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var l=e.i(80961);let d=(0,r.default)("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]),c=(0,r.default)("stamp",[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]]);var h=e.i(2589),u=e.i(2483),p=e.i(73443),g=e.i(21334),m=e.i(49430),y=e.i(92064);let f=[{name:"Duitama, Colombia",lat:5.821944,lng:-73.029722,zoom:14},{name:"Tunja, Boyacá, Colombia",lat:5.5353,lng:-73.3678,zoom:14},{name:"Sogamoso, Boyacá, Colombia",lat:5.7144,lng:-72.9339,zoom:14},{name:"Paipa, Boyacá, Colombia",lat:5.7772,lng:-73.1174,zoom:14},{name:"Villa de Leyva, Boyacá, Colombia",lat:5.6341,lng:-73.5262,zoom:14},{name:"Chiquinquirá, Boyacá, Colombia",lat:5.618,lng:-73.8168,zoom:14},{name:"Tibasosa, Boyacá, Colombia",lat:5.8294,lng:-73.0165,zoom:14},{name:"Roma, Italia",lat:41.9028,lng:12.4964,zoom:12},{name:"Milán, Italia",lat:45.4642,lng:9.19,zoom:12},{name:"Venecia, Italia",lat:45.4408,lng:12.3155,zoom:13},{name:"Florencia, Italia",lat:43.7696,lng:11.2558,zoom:13},{name:"Nápoles, Italia",lat:40.8518,lng:14.2681,zoom:13},{name:"París, Francia",lat:48.8566,lng:2.3522,zoom:12},{name:"Tokio, Japón",lat:35.6895,lng:139.6917,zoom:11},{name:"Nueva York, EE. UU.",lat:40.7128,lng:-74.006,zoom:12},{name:"Londres, Reino Unido",lat:51.5074,lng:.1278,zoom:12},{name:"Río de Janeiro, Brasil",lat:-22.9068,lng:-43.1729,zoom:12},{name:"Sídney, Australia",lat:-33.8688,lng:151.2093,zoom:12},{name:"El Cairo, Egipto",lat:30.0444,lng:31.2357,zoom:12}],v=()=>{let e=(0,i.useMapStore)(e=>e.updateMapState),r=(0,i.useMapStore)(e=>e.mapInstance),[s,n]=(0,m.useState)(""),[l,d]=(0,m.useState)(!1),c=(0,m.useRef)(null),h=(0,m.useMemo)(()=>{if(!s)return f;let e=s.toLowerCase();return f.filter(t=>t.name.toLowerCase().includes(e)).slice(0,7)},[s]);return(0,m.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]),(0,t.jsxs)("div",{ref:c,className:"relative w-full max-w-sm mx-auto",style:{marginBottom:240*!!l},children:[(0,t.jsxs)("div",{className:"relative flex items-center bg-white rounded-xl shadow-2xl overflow-hidden border border-gray-200",children:[(0,t.jsx)("div",{className:"p-3 text-gray-400",children:(0,t.jsx)(o.Globe,{className:"w-5 h-5"})}),(0,t.jsx)("input",{type:"text",placeholder:"Usar ubicación...",value:s,onChange:e=>n(e.target.value),onFocus:()=>d(!0),className:"w-full py-3 pr-4 text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-0 text-sm font-semibold"}),(0,t.jsx)("button",{onClick:()=>n(""),className:"p-3 transition-opacity ".concat(s?"opacity-100":"opacity-0 pointer-events-none"),title:"Limpiar búsqueda",children:(0,t.jsx)(y.Search,{className:"w-4 h-4 text-gray-500"})})]}),l&&(s||h.length>0)&&(0,t.jsxs)("div",{className:"absolute top-full left-0 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl overflow-hidden z-20 max-h-60 overflow-y-auto",children:[h.map((i,o)=>(0,t.jsxs)("button",{onClick:()=>(t=>{if(n(t.name),d(!1),r){let i={lat:t.lat,lng:t.lng},o=t.zoom;r.setCenter(i),r.setZoom(o),e({center:i,zoom:o})}})(i),className:"flex items-center w-full p-3 text-left text-sm text-gray-700 hover:bg-blue-50 transition-colors",children:[(0,t.jsx)(a,{className:"w-4 h-4 mr-3 text-blue-500 flex-shrink-0"}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"font-medium",children:i.name})})]},i.name)),0===h.length&&s&&(0,t.jsx)("div",{className:"p-3 text-center text-sm text-gray-500",children:"No se encontraron resultados."})]})]})};var x=e.i(42880),C=e.i(73885),P=e.i(75410),b=e.i(67815),I=e.i(20336),M=e.i(19455),w=e.i(72436);let S=[{key:"DRAW_POINT",name:"Punto",icon:I.CircleDot,description:"Define un único punto en el mapa."},{key:"DRAW_CIRCLE",name:"Círculo",icon:x.Circle,description:"Dibuja una figura circular con un punto central y radio."},{key:"DRAW_RECTANGLE",name:"Rectángulo",icon:b.Square,description:"Dibuja un área rectangular definida por dos esquinas."}],E=[{key:"DRAW_LINESTRING",name:"Línea",icon:C.Minus,description:"Dibuja un camino compuesto por múltiples segmentos."},{key:"DRAW_POLYGON",name:"Polígono (Área)",icon:P.Shapes,description:"Dibuja una forma cerrada para medir un área."}],j=()=>{let e=(0,i.useMapStore)(e=>e.activeTool),o=(0,i.useMapStore)(e=>e.setActiveTool);return(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsx)("h2",{children:"Figuras Geometricas"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"DRAW_POINT"===e?"Presiona el mapa":"DRAW_CIRCLE"===e?"Presiona en el mapa, luego mueve el cursor para cambiar el tamaño del circulo, vuelve a presionar para terminar":"DRAW_RECTANGLE"===e?"Para dibujar presiona en el mapa, luego arrastra para crear el rectangulo":""}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[S.map(i=>{let{key:r,name:s,icon:n,description:a}=i;return(0,t.jsxs)("button",{onClick:()=>{if(e===r)return o("static");o(r)},title:a,className:"flex flex-col align-middle justify-center items-center flex-1 p-3 rounded-xl border-2 transition-all duration-200 \n              ".concat(e===r?"bg-emerald-600 text-white border-emerald-700 shadow-xl":"bg-white text-gray-700 border-gray-200 hover:bg-emerald-50 hover:border-emerald-300"),children:[(0,t.jsx)(n,{className:"w-6 h-6 mb-2"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:s})]},r)}),(0,t.jsx)(w.Separator,{})]}),(0,t.jsx)("h2",{children:"Dibujo Libre"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"DRAW_POLYGON"===e?"*Para guardar presiona el circulo que aparece despues de crear un triangulo":"*Guarda presionando el circulo que aparece despues de dibujar una linea"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-3",children:E.map(i=>{let{key:r,name:s,icon:n,description:a}=i;return(0,t.jsxs)("button",{onClick:()=>{if(e===r)return o("static");o(r)},title:a,className:"flex flex-col align-middle justify-center items-center flex-1 p-3 rounded-xl border-2 transition-all duration-200 \n              ".concat(e===r?"bg-emerald-600 text-white border-emerald-700 shadow-xl":"bg-white text-gray-700 border-gray-200 hover:bg-emerald-50 hover:border-emerald-300"),children:[(0,t.jsx)(n,{className:"w-6 h-6 mb-2"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:s})]},r)})}),(0,t.jsx)(M.Button,{className:"static"===e?"w-full bg-gray-500 hover:bg-gray-400":"w-full bg-red-500 hover:bg-red-400",onClick:()=>o("static"),children:"Parar de Dibujar"})]})};var _=e.i(93479),D=e.i(10204),k=e.i(99375);let F=()=>(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("section",{className:"flex flex-col gap-5",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"access-url",children:"URL de Acceso"}),(0,t.jsx)(k.Switch,{id:"access-url"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Genera un enlace único que puede ser compartido para acceder directamente al contenido."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"password-protection",children:"Contraseña"}),(0,t.jsx)(k.Switch,{id:"password-protection"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Requiere una contraseña para la visualización del contenido"})]})]})}),N=()=>(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("section",{className:"flex flex-col gap-5",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"publicly-available",children:"Disponible Públicamente"}),(0,t.jsx)(k.Switch,{id:"publicly-available"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Permite que cualquier persona pueda ver este contenido en el mapa publico."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"password-protection",children:"Contraseña"}),(0,t.jsx)(k.Switch,{id:"password-protection"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Requiere una contraseña para la visualización del contenido"})]})]})}),O=()=>(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("section",{className:"flex flex-col gap-5",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"edit-content",children:"Editar Contenido"}),(0,t.jsx)(k.Switch,{id:"edit-content"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Permite a los usuarios modificar textos, descripciones, marcadores y su informacion."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"create-markers",children:"Crear Marcadores"}),(0,t.jsx)(k.Switch,{id:"create-markers"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Autoriza a los usuarios a añadir nuevos Marcadores."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("section",{className:"flex flex-row justify-between",children:[(0,t.jsx)("label",{htmlFor:"create-drawings",children:"Crear Dibujos"}),(0,t.jsx)(k.Switch,{id:"create-drawings"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Habilita la herramienta de dibujo para los Usuarios."})]})]})}),T=(0,r.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),A=()=>{let e=(0,i.useMapStore)(e=>e.geolocationAvailable),o=(0,i.useMapStore)(e=>e.fetchUserLocation),[r,s]=(0,m.useState)(!1),n=async()=>{s(!0),await o(),s(!1)};return(0,t.jsx)("div",{className:"w-full my-2",children:(0,t.jsx)("button",{onClick:n,disabled:r,className:"\n      w-full py-3 px-4 rounded-xl shadow-md font-medium\n      flex items-center justify-center gap-2 transition-all duration-300\n      ".concat(r?"bg-blue-300 text-white cursor-wait":e?"bg-emerald-500 text-white hover:bg-emerald-600":"bg-white text-blue-600 border border-gray-200 hover:bg-blue-500 hover:text-white","\n    "),title:"Centrar en mi ubicación actual",children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T,{className:"h-5 w-5 animate-spin"}),(0,t.jsx)("span",{children:"Ubicando..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Usar mi localización"})]})})})},L=()=>{let e=(0,i.useMapStore)(e=>e.title),o=(0,i.useMapStore)(e=>e.objective),r=(0,i.useMapStore)(e=>e.description),s=(0,i.useMapStore)(e=>e.setTitle),n=(0,i.useMapStore)(e=>e.setObjective),a=(0,i.useMapStore)(e=>e.setDescription),l=(0,i.useMapStore)(e=>e.interestSidebarVisible),d=(0,i.useMapStore)(e=>e.toggleSidebar);return l?(0,t.jsxs)("div",{className:"absolute top-4 right-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl border border-gray-200 max-h-[96vh] max-w-[290px] min-w-[290px] overflow-y-auto z-10",children:[(0,t.jsx)(u.XIcon,{onClick:()=>d("interest"),className:"absolute right-2 top-2 w-8 h-8 cursor-pointer",color:"black"}),(0,t.jsxs)("section",{className:"pb-4 flex items-center gap-2",children:[(0,t.jsx)(h.TargetIcon,{})," ",(0,t.jsx)("p",{children:"Punto de Interes"})]}),(0,t.jsx)(D.Label,{children:"Nombre:"}),(0,t.jsx)(_.Input,{className:"my-3",type:"text",value:e,onChange:e=>s(e.target.value)}),(0,t.jsx)(D.Label,{children:"Objetivo:"}),(0,t.jsx)(_.Input,{className:"my-3",type:"text",value:o,onChange:e=>n(e.target.value)}),(0,t.jsx)(D.Label,{children:"Descripción:"}),(0,t.jsx)("textarea",{className:"my-3 border-2 w-full rounded-md p-2",value:r,onChange:e=>a(e.target.value)})]}):(0,t.jsx)(m.default.Fragment,{})},B=e=>{let{className:o="",classNameSelector:r=""}=e,s=(0,i.useMapStore)(e=>e.createSidebarVisible),n=(0,i.useMapStore)(e=>e.toggleSidebar);return s?(0,t.jsxs)("div",{className:"".concat(o," absolute top-4 right-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl border border-gray-200 max-h-[96vh] max-w-[290px] min-w-[290px] overflow-y-auto z-10"),children:[o.length>0?(0,t.jsx)(t.Fragment,{}):(0,t.jsx)(u.XIcon,{onClick:()=>n("create"),className:"absolute right-2 top-2 w-8 h-8",color:"black"}),(0,t.jsx)("h2",{className:"mb-4",children:"Marcadores y Geometria "}),(0,t.jsxs)(p.Accordion,{type:"multiple",children:[(0,t.jsxs)(p.AccordionItem,{value:"marcadores",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(a,{})," Marcadores"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(g.default,{className:r})})]}),(0,t.jsxs)(p.AccordionItem,{value:"dibujar",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(d,{})," Geometria"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(j,{})})]})]})]}):(0,t.jsx)(m.default.Fragment,{})},R=()=>{let e=(0,i.useMapStore)(e=>e.navigateSidebarVisible),o=(0,i.useMapStore)(e=>e.markers),r=(0,i.useMapStore)(e=>e.updateMapState),s=(0,i.useMapStore)(e=>e.mapInstance),a=(0,i.useMapStore)(e=>e.toggleSidebar);return e?(0,t.jsxs)("div",{className:"absolute top-4 right-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl border border-gray-200 max-h-[96vh] max-w-[290px] min-w-[290px] overflow-y-auto z-10",children:[(0,t.jsx)(u.XIcon,{onClick:()=>a("navigate"),className:"absolute right-2 top-2 w-8 h-8",color:"black"}),(0,t.jsxs)(p.Accordion,{type:"multiple",children:[(0,t.jsx)("h1",{className:"mb-4",children:"Navegacion "}),(0,t.jsxs)(p.AccordionItem,{value:"Destinos de Interes",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(n.Map,{})," Destinos Populares"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(v,{})})]}),(0,t.jsxs)(p.AccordionItem,{value:"Destinos marcador",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(l.MapPinnedIcon,{})," Ir a Marcador"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)("div",{className:"flex flex-col gap-4 overflow-y-auto max-h-[500px] ",children:o.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between px-2 bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition cursor-pointer",onClick:()=>{(e=>{if(s){let t={lat:e.lat,lng:e.lng};s.setCenter(t),s.setZoom(17),r({center:t,zoom:17})}})({lat:e.position.lat,lng:e.position.lng}),console.log(e)},children:(0,t.jsxs)("div",{className:"flex items-center gap-1 p-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border",style:{background:e.background}}),(0,t.jsx)("div",{className:"flex flex-col max-w-[100px]",children:(0,t.jsx)("span",{className:"font-medium text-gray-800 truncate",children:e.title||"Sin nombre"})})]})},e.id))})})]}),(0,t.jsx)(A,{})]})]}):(0,t.jsx)(m.default.Fragment,{})},W=()=>{let e=(0,i.useMapStore)(e=>e.publishSidebarVisible),r=(0,i.useMapStore)(e=>e.toggleSidebar);return e?(0,t.jsxs)("div",{className:"absolute top-4 right-4 p-4 bg-white bg-opacity-90 rounded-xl shadow-2xl border border-gray-200 max-h-[96vh] max-w-[290px] min-w-[290px] overflow-y-auto z-10",children:[(0,t.jsx)(u.XIcon,{onClick:()=>r("publish"),className:"absolute right-2 top-2 w-8 h-8",color:"black"}),(0,t.jsxs)(p.Accordion,{type:"multiple",children:[(0,t.jsx)("h1",{className:"mb-4 ",children:"Acceso y Configuración "}),(0,t.jsxs)(p.AccordionItem,{value:"configuracion_private",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(s,{})," Acceso Privado:"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(F,{})})]}),(0,t.jsxs)(p.AccordionItem,{value:"configuracion_public",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(o.Globe,{})," Acceso Público:"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(N,{})})]}),(0,t.jsxs)(p.AccordionItem,{value:"configuracion_permits",children:[(0,t.jsx)(p.AccordionTrigger,{children:(0,t.jsxs)("section",{className:"flex row justify-baseline align-middle gap-2",children:[(0,t.jsx)(c,{}),"Permisos de Usuarios"]})}),(0,t.jsx)(p.AccordionContent,{children:(0,t.jsx)(O,{})})]})]})]}):(0,t.jsx)(m.default.Fragment,{})}},27505,e=>{"use strict";e.s(["FullScreenGoogleMapCreate",()=>e2,"FullScreenGoogleMapCreateContained",()=>e3],27505);var t,i,o=e.i(78196),r=e.i(49430),s=e.i(31272),n=e.i(13080);function a(){return(a=Object.assign.bind()).apply(null,arguments)}!function(e){e.Commit="commit",e.Provisional="provisional",e.Finish="finish"}(t||(t={}));let l={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT_FEATURE_ID:"selectionPointFeatureId",SELECTION_POINT:"selectionPoint"},d={MODE:"mode",CURRENTLY_DRAWING:"currentlyDrawing",EDITED:"edited",CLOSING_POINT:"closingPoint",SNAPPING_POINT:"snappingPoint",COORDINATE_POINT:"coordinatePoint",COORDINATE_POINT_FEATURE_ID:"coordinatePointFeatureId",COORDINATE_POINT_IDS:"coordinatePointIds",PROVISIONAL_COORDINATE_COUNT:"provisionalCoordinateCount",COMMITTED_COORDINATE_COUNT:"committedCoordinateCount",MARKER:"marker"};function c(e){return!!(e&&"object"==typeof e&&null!==e&&!Array.isArray(e))}function h(e){return!!(e&&"object"==typeof e&&"properties"in e&&"object"==typeof e.properties&&null!==e.properties&&"mode"in e.properties)}function u(e){return!!("number"==typeof e&&!isNaN(new Date(e).valueOf()))}!function(e){e.Drawing="drawing",e.Select="select",e.Static="static",e.Render="render"}(i||(i={}));let p={rightClick:!0,contextMenu:!1,leftClick:!0,onDragStart:!0,onDrag:!0,onDragEnd:!0};class g{get state(){return this._state}set state(e){throw Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if("object"!=typeof e)throw Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}updateOptions(e){null!=e&&e.styles&&(this.styles=a({},this._styles,e.styles)),null!=e&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),null!=e&&e.validation&&(this.validate=e&&e.validation),null!=e&&e.projection&&(this.projection=e.projection),void 0!==(null==e?void 0:e.pointerEvents)&&(this.pointerEvents=e.pointerEvents)}allowPointerEvent(e,t){return"boolean"==typeof e?e:"function"!=typeof e||e(t)}setDrawing(){if("started"!==this._state)throw Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if("stopped"!==this._state&&"registered"!==this._state&&"drawing"!==this._state&&"selecting"!==this._state)throw Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if("started"!==this._state)throw Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if("unregistered"!==this._state)throw Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}afterFeatureUpdated(e){}performFeatureValidation(e){if("unregistered"===this._state)throw Error("Mode must be registered");let i=function(e,t){let i;if(c(e))if(null==e.id)i="Feature has no id";else if("string"!=typeof e.id&&"number"!=typeof e.id)i="Feature must be string or number as per GeoJSON spec";else if(t(e.id))if(c(e.geometry))if(c(e.properties))if("string"==typeof e.geometry.type&&["Polygon","LineString","Point"].includes(e.geometry.type))if(Array.isArray(e.geometry.coordinates)){if(!e.properties.mode||"string"!=typeof e.properties.mode)return{valid:!1,reason:"Feature does not have a valid mode property"}}else i="Feature coordinates is not an array";else i="Feature is not Point, LineString or Polygon";else i="Feature has no properties";else i="Feature has no geometry";else i="Feature must match the id strategy (default is UUID4)";else i="Feature is not object";return i?{valid:!1,reason:i}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){let o=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Provisional});return{valid:i.valid&&o.valid,reason:o.reason}}return{valid:i.valid,reason:i.reason}}validateModeFeature(e,t){let i=this.performFeatureValidation(e);return i.valid?e.properties.mode!==this.mode?{valid:!1,reason:"Feature mode property does not match the mode being added to"}:t(e):{valid:!1,reason:i.reason}}onFinish(e,t){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,t){}onDrag(e,t){}onDragEnd(e,t){}getHexColorStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getNumericStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getUrlStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getStylingValue(e,t,i){return void 0===e?t:"function"==typeof e?e(i):e}constructor(e,t=!1){this._state="unregistered",this._styles={},this.pointerEvents=p,this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=i.Drawing,this.mode="base",t||this.updateOptions(e)}}class m extends g{constructor(...e){super(...e),this.type=i.Select}}function y(e,t){let i=e=>e*Math.PI/180,o=i(e[1]),r=i(e[0]),s=i(t[1]),n=s-o,a=i(t[0])-r,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(o)*Math.cos(s)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}function f(e){return e%360*Math.PI/180}function v(e){return e%(2*Math.PI)*180/Math.PI}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,i=Math.pow(10,t);return Math.round(e*i)/i}let C=(e,t)=>({x:0===e?0:.017453292519943295*e*6378137,y:0===t?0:6378137*Math.log(Math.tan(Math.PI/4+.017453292519943295*t/2))}),P=(e,t)=>({lng:0===e?0:e/6378137*57.29577951308232,lat:0===t?0:(2*Math.atan(Math.exp(t/6378137))-Math.PI/2)*57.29577951308232});function b(e){let{center:t,radiusKilometers:i,coordinatePrecision:o}=e,r=e.steps?e.steps:64,s=[];for(let e=0;e<r;e++){let n=function(e,t,i){let o=f(e[0]),r=f(e[1]),s=f(i),n=t/6371.0088,a=Math.asin(Math.sin(r)*Math.cos(n)+Math.cos(r)*Math.sin(n)*Math.cos(s));return[v(o+Math.atan2(Math.sin(s)*Math.sin(n)*Math.cos(r),Math.cos(n)-Math.sin(r)*Math.sin(a))),v(a)]}(t,i,-360*e/r);s.push([x(n[0],o),x(n[1],o)])}return s.push(s[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[s]},properties:{}}}function I(e){let t;if("Polygon"===e.geometry.type)t=e.geometry.coordinates;else{if("LineString"!==e.geometry.type)throw Error("Self intersects only accepts Polygons and LineStrings");t=[e.geometry.coordinates]}let i=[];for(let e=0;e<t.length;e++)for(let o=0;o<t[e].length-1;o++)for(let r=0;r<t.length;r++)for(let s=0;s<t[r].length-1;s++)!function(e,o,r,s){let n,a,l=t[e][o],d=t[e][o+1],c=t[r][s],h=t[r][s+1],u=function(e,t,i,o){if(M(e,i)||M(e,o)||M(t,i)||M(o,i))return null;let r=e[0],s=e[1],n=t[0],a=t[1],l=i[0],d=i[1],c=o[0],h=o[1],u=(r-n)*(d-h)-(s-a)*(l-c);return 0===u?null:[((r*a-s*n)*(l-c)-(r-n)*(l*h-d*c))/u,((r*a-s*n)*(d-h)-(s-a)*(l*h-d*c))/u]}(l,d,c,h);if(null!==u){var p;n=d[0]!==l[0]?(u[0]-l[0])/(d[0]-l[0]):(u[1]-l[1])/(d[1]-l[1]),a=h[0]!==c[0]?(u[0]-c[0])/(h[0]-c[0]):(u[1]-c[1])/(h[1]-c[1]),n<0||n>1||(p=a)<0||p>1||(u.toString(),i.push(u))}}(e,o,r,s);return i.length>0}function M(e,t){return e[0]===t[0]&&e[1]===t[1]}function w(e,t){return E(e[0])<=t&&E(e[1])<=t}function S(e){var t,i;return 2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&1/0!==e[0]&&1/0!==e[1]&&(i=e[0])>=-180&&i<=180&&(t=e[1])>=-90&&t<=90}function E(e){let t=1,i=0;for(;Math.round(e*t)/t!==e;)t*=10,i++;return i}function j(e,t){var i,o;if("Polygon"!==e.geometry.type)return{valid:!1,reason:"Feature is not a Polygon"};if(1!==e.geometry.coordinates.length)return{valid:!1,reason:"Feature has holes"};if(e.geometry.coordinates[0].length<4)return{valid:!1,reason:"Feature has less than 4 coordinates"};for(let i=0;i<e.geometry.coordinates[0].length;i++){if(!S(e.geometry.coordinates[0][i]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!w(e.geometry.coordinates[0][i],t))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return(i=e.geometry.coordinates[0][0])[0]!==(o=e.geometry.coordinates[0][e.geometry.coordinates[0].length-1])[0]||i[1]!==o[1]?{valid:!1,reason:"Feature coordinates are not closed"}:{valid:!0}}function _(e,t){let i=j(e,t);return i.valid?I(e)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:i}let D={cancel:"Escape",finish:"Enter"},k={start:"crosshair"};class F extends g{updateOptions(e){super.updateOptions(e),null!=e&&e.cursors&&(this.cursors=a({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=a({},this.keyEvents,e.keyEvents)),null!=e&&e.startingRadiusKilometers&&(this.startingRadiusKilometers=e.startingRadiusKilometers)}close(){if(void 0===this.currentCircleId)return;this.store.updateProperty([{id:this.currentCircleId,property:d.CURRENTLY_DRAWING,value:void 0}]);let e=this.currentCircleId;if(this.validate&&e){let i=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:i,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if("right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(0===this.clickCount){this.center=[e.lng,e.lat];let t=b({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),[i]=this.store.create([{geometry:t.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers,[d.CURRENTLY_DRAWING]:!0}}]);this.currentCircleId=i,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else 1===this.clickCount&&this.center&&void 0!==this.currentCircleId&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(e),this.close()}onMouseMove(e){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(e)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){let e=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e])}catch(e){}}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});return"Feature"===e.type&&"Polygon"===e.geometry.type&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10),t}validateFeature(e){return this.validateModeFeature(e,e=>_(e,this.coordinatePrecision))}updateCircle(e){if(1===this.clickCount&&this.center&&this.currentCircleId){let i,o=y(this.center,[e.lng,e.lat]);if("web-mercator"===this.projection){let t=function(e,t){let i=1e3*y(e,t);if(0===i)return 1;let{x:o,y:r}=C(e[0],e[1]),{x:s,y:n}=C(t[0],t[1]);return Math.sqrt(Math.pow(s-o,2)+Math.pow(n-r,2))/i}(this.center,[e.lng,e.lat]);i=function(e){let{center:t,radiusKilometers:i,coordinatePrecision:o}=e,r=e.steps?e.steps:64,s=1e3*i,[n,a]=t,{x:l,y:d}=C(n,a),c=[];for(let e=0;e<r;e++){let t=360*e/r*Math.PI/180,[i,n]=[l+s*Math.cos(t),d+s*Math.sin(t)],{lng:a,lat:h}=P(i,n);c.push([x(a,o),x(h,o)])}return c.push(c[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[c]},properties:{}}}({center:this.center,radiusKilometers:o*t,coordinatePrecision:this.coordinatePrecision})}else{if("globe"!==this.projection)throw Error("Invalid projection");i=b({center:this.center,radiusKilometers:o,coordinatePrecision:this.coordinatePrecision})}(!this.validate||this.validate({type:"Feature",id:this.currentCircleId,geometry:i.geometry,properties:{radiusKilometers:o}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Provisional}).valid)&&(this.store.updateGeometry([{id:this.currentCircleId,geometry:i.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:o}]))}}afterFeatureUpdated(e){this.currentCircleId===e.id&&(this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted())}constructor(e){super(e,!0),this.mode="circle",this.center=void 0,this.clickCount=0,this.currentCircleId=void 0,this.keyEvents=D,this.cursors=k,this.startingRadiusKilometers=1e-5,this.cursorMovedAfterInitialCursorDown=!1,this.updateOptions(e)}}let N=(e,t)=>{let{x:i,y:o}=e,{x:r,y:s}=t,n=r-i,a=s-o;return Math.sqrt(a*a+n*n)};function O(e){if(!function(e){let t=e.coordinates[0],i=0;for(let e=0;e<t.length-1;e++){let[o,r]=t[e],[s,n]=t[e+1];i+=(s-o)*(n+r)}return i<0}(e))return{type:"Polygon",coordinates:[e.coordinates[0].reverse()]}}class T{constructor({store:e,mode:t,project:i,unproject:o,pointerDistance:r,coordinatePrecision:s,projection:n}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=t,this.project=i,this.unproject=o,this.pointerDistance=r,this.coordinatePrecision=s,this.projection=n}}function A(e){let{unproject:t,point:i,pointerDistance:o}=e,r=o/2,{x:s,y:n}=i;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[t(s-r,n-r),t(s+r,n-r),t(s+r,n+r),t(s-r,n+r),t(s-r,n-r)].map(e=>[e.lng,e.lat])]}}}class L extends T{create(e){let{containerX:t,containerY:i}=e;return A({unproject:this.unproject,point:{x:t,y:i},pointerDistance:this.pointerDistance})}constructor(e){super(e)}}class B extends T{measure(e,t){let{x:i,y:o}=this.project(t[0],t[1]);return N({x:i,y:o},{x:e.containerX,y:e.containerY})}constructor(e){super(e)}}class R extends T{getSnappable(e,t){let i=this.clickBoundingBox.create(e),o=this.store.search(i,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return o.forEach(t=>{let i;if("Polygon"===t.geometry.type)i=t.geometry.coordinates[0];else{if("LineString"!==t.geometry.type)return;i=t.geometry.coordinates}i.forEach((i,o)=>{let s=this.pixelDistance.measure(e,i);s<r.minDist&&s<this.pointerDistance&&(r.coordinate=i,r.minDist=s,r.featureId=t.id,r.featureCoordinateIndex=o)})}),r}constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=e=>this.getSnappable(e,e=>!!(e.properties&&e.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(e,t)=>this.getSnappable(e,e=>!!(e.properties&&e.properties.mode===this.mode&&e.id!==t)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}}function W(e,t,i){let o=f(e[0]),r=f(e[1]),s=f(i),n=t/6371.0088,a=Math.asin(Math.sin(r)*Math.cos(n)+Math.cos(r)*Math.sin(n)*Math.cos(s));return[v(o+Math.atan2(Math.sin(s)*Math.sin(n)*Math.cos(r),Math.cos(n)-Math.sin(r)*Math.sin(a))),v(a)]}function G(e,t){let i=f(e[0]),o=f(t[0]),r=f(e[1]),s=f(t[1]);return v(Math.atan2(Math.sin(o-i)*Math.cos(s),Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(o-i)))}function U(e){return Math.PI/180*e}function z(e){return 180/Math.PI*e}class V extends T{generateInsertionCoordinates(e,t,i){let o=[e,t],r=0;for(let e=0;e<o.length-1;e++)r+=y(o[0],o[1]);if(r<=i)return o;let s=r/i-1;Number.isInteger(s)||(s=Math.floor(s)+1);let n=[];for(let e=0;e<s;e++){let t=function(e,t,i){let o=[],r=e.length,s,n,a,l=0;for(let r=0;r<e.length&&!(t>=l&&r===e.length-1);r++){if(l>t&&0===o.length){if(!(s=t-l))return o.push(e[r]),o;n=G(e[r],e[r-1])-180,a=W(e[r],s,n),o.push(a)}if(l>=i)return(s=i-l)?(n=G(e[r],e[r-1])-180,a=W(e[r],s,n),o.push(a)):o.push(e[r]),o;if(l>=t&&o.push(e[r]),r===e.length-1)return o;l+=y(e[r],e[r+1])}if(l<t&&e.length===r)throw Error("Start position is beyond line");let d=e[e.length-1];return[d,d]}(o,i*e,i*(e+1));n.push(t)}let a=[];for(let e=0;e<n.length;e++)a.push(n[e][1]);return this.limitCoordinates(a)}generateInsertionGeodesicCoordinates(e,t,i){let o=y(e,t),r=function(e,t,i){let o=[],r=U(e[1]),s=U(e[0]),n=U(t[1]),a=U(t[0]);i+=1;let l=2*Math.asin(Math.sqrt(Math.sin((n-r)/2)**2+Math.cos(r)*Math.cos(n)*Math.sin((a-s)/2)**2));if(0===l||isNaN(l))return o;for(let e=0;e<=i;e++){let t=e/i,d=Math.sin((1-t)*l)/Math.sin(l),c=Math.sin(t*l)/Math.sin(l),h=d*Math.cos(r)*Math.cos(s)+c*Math.cos(n)*Math.cos(a),u=d*Math.cos(r)*Math.sin(s)+c*Math.cos(n)*Math.sin(a),p=d*Math.sin(r)+c*Math.sin(n);if(isNaN(h)||isNaN(u)||isNaN(p))continue;let g=Math.atan2(p,Math.sqrt(h**2+u**2)),m=Math.atan2(u,h);isNaN(g)||isNaN(m)||o.push([z(m),z(g)])}return o.slice(1,-1)}(e,t,Math.floor(o/i));return this.limitCoordinates(r)}limitCoordinates(e){return e.map(e=>[x(e[0],this.config.coordinatePrecision),x(e[1],this.config.coordinatePrecision)])}constructor(e){super(e),this.config=void 0,this.config=e}}function Y(e,t){return e[0]===t[0]&&e[1]===t[1]}function X(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))}function K(e,t){return Math.acos(Math.min(Math.max(function(e,t){let[i,o,r]=e,[s,n,a]=t;return i*s+o*n+r*a}(e,t)/(X(e)*X(t)),-1),1))}function H(e){let t=f(e[1]),i=f(e[0]);return[Math.cos(t)*Math.cos(i),Math.cos(t)*Math.sin(i),Math.sin(t)]}function q(e){let[t,i,o]=e,r=v(Math.asin(o));return[v(Math.atan2(i,t)),r]}class Z extends T{getSnappable(e,t){let i=this.clickBoundingBox.create(e),o=this.store.search(i,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return o.forEach(t=>{let i,o;if("Polygon"===t.geometry.type)i=t.geometry.coordinates[0];else{if("LineString"!==t.geometry.type)return;i=t.geometry.coordinates}let s=[];for(let e=0;e<i.length-1;e++)s.push([i[e],i[e+1]]);let n=[e.lng,e.lat];if("web-mercator"===this.config.projection?o=function(e,t){let i=[1/0,1/0],o=1/0,r=0;for(let s of t){let n=s[0],a=s[1],l,d=1/0,c=C(n[0],n[1]),h=C(a[0],a[1]),u=C(e[0],e[1]);if(n[0]===e[0]&&n[1]===e[1])l=n;else if(a[0]===e[0]&&a[1]===e[1])l=a;else{let{x:e,y:t}=function(e,t,i){let o=t.x-e.x,r=t.y-e.y,s=Math.max(0,Math.min(1,((i.x-e.x)*o+(i.y-e.y)*r)/(o*o+r*r)));return{x:e.x+s*o,y:e.y+s*r}}(c,h,u),{lng:i,lat:o}=P(e,t);l=[i,o]}l&&(d=N(u,C(l[0],l[1])))<o&&(i=l,o=d,r=t.indexOf(s))}return 1/0===o?void 0:{coordinate:i,lineIndex:r,distance:o}}(n,s):"globe"===this.config.projection&&(o=function(e,t){let i=[1/0,1/0],o=1/0,r=0;for(let s of t){let n=s[0],a=s[1],l,d=1/0;n[0]===e[0]&&n[1]===e[1]?l=n:a[0]===e[0]&&a[1]===e[1]?l=a:[l]=function(e,t,i){let o,r=H(e),s=H(t),[n,a,l]=H(i),[d,c,h]=function(e,t){let[i,o,r]=e,[s,n,a]=t;return[o*a-r*n,r*s-i*a,i*n-o*s]}(r,s),u=c*l-h*a,p=h*n-d*l,g=d*a-c*n,m=g*c-p*h,f=u*h-g*d,v=p*d-u*c,x=1/Math.sqrt(Math.pow(m,2)+Math.pow(f,2)+Math.pow(v,2)),C=[m*x,f*x,v*x],P=[-1*m*x,-1*f*x,-1*v*x],b=K(r,s),I=K(r,C),M=K(s,C),w=K(r,P),S=K(s,P);return K(r,o=I<w&&I<S||M<w&&M<S?C:P)>b||K(s,o)>b?y(q(o),q(r))<=y(q(o),q(s))?[q(r),!0,!1]:[q(s),!1,!0]:[q(o),!1,!1]}(n,a,e),l&&(d=y(e,l))<o&&(i=l,o=d,r=t.indexOf(s))}return 1/0===o?void 0:{coordinate:i,distance:o,lineIndex:r}}(n,s)),!o)return;let a=this.pixelDistance.measure(e,o.coordinate);a<r.minDistance&&a<this.pointerDistance&&(r.featureId=t.id,r.coordinate=[x(o.coordinate[0],this.config.coordinatePrecision),x(o.coordinate[1],this.config.coordinatePrecision)],r.featureCoordinateIndex=o.lineIndex,r.minDistance=a)}),r}constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=e=>{let t=this.getSnappable(e,e=>!!(e.properties&&e.properties.mode===this.mode));return t.coordinate?[x(t.coordinate[0],this.config.coordinatePrecision),x(t.coordinate[1],this.config.coordinatePrecision)]:void 0},this.getSnappableCoordinate=(e,t)=>{let i=this.getSnappable(e,e=>!!(e.properties&&e.properties.mode===this.mode&&e.id!==t));return i.coordinate?[x(i.coordinate[0],this.config.coordinatePrecision),x(i.coordinate[1],this.config.coordinatePrecision)]:void 0},this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}}let J={cancel:"Escape",finish:"Enter"},Q={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class $ extends g{updateOptions(e){super.updateOptions(e),null!=e&&e.cursors&&(this.cursors=a({},this.cursors,e.cursors)),null!=e&&e.snapping&&(this.snapping=e.snapping),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=a({},this.keyEvents,e.keyEvents)),null!=e&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}updateSnappedCoordinate(e){let t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{let[e]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[d.SNAPPING_POINT]:!0}}]);this.snappedPointId=e}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);return t}close(){if(void 0===this.currentId)return;let e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop(),this.updateGeometries([...e.coordinates],void 0,t.Commit),this.store.updateProperty([{id:this.currentId,property:d.CURRENTLY_DRAWING,value:void 0}]);let i=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommittedCoordinates=void 0,"drawing"===this.state&&this.setStarted(),this.onFinish(i,{mode:this.mode,action:"draw"})}updateGeometries(e,t,i){if(!this.currentId)return;let o={type:"LineString",coordinates:e};if(this.validate&&!this.validate({type:"Feature",geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:i}).valid)return;let r=[{id:this.currentId,geometry:o}];this.closingPointId&&t&&r.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),"commit"===i&&(this.lastCommittedCoordinates=o.coordinates),this.store.updateGeometry(r)}generateInsertCoordinates(e,t){if(!this.insertCoordinates||!this.lastCommittedCoordinates)throw Error("Not able to insert coordinates");if("amount"!==this.insertCoordinates.strategy)throw Error("Strategy does not exist");let i=y(e,t)/(this.insertCoordinates.value+1),o=[];return"globe"===this.projection?o=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,i):"web-mercator"===this.projection&&(o=this.insertPoint.generateInsertionCoordinates(e,t,i)),o}createLine(e){let[t]=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode,[d.CURRENTLY_DRAWING]:!0}}]);this.lastCommittedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(e){if(!this.currentId)return;let i=this.store.getGeometryCopy(this.currentId).coordinates,[o]=this.store.create([{geometry:{type:"Point",coordinates:[...e]},properties:{mode:this.mode,[d.CLOSING_POINT]:!0}}]);this.closingPointId=o,this.setCursor(this.cursors.close);let r=[...i,e];this.updateGeometries(r,void 0,t.Commit),this.currentCoordinate++}updateToLine(e,i){if(!this.currentId)return;let o=this.store.getGeometryCopy(this.currentId).coordinates,[r,s]=this.lastCommittedCoordinates?this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1]:o[o.length-2],{x:n,y:a}=this.project(r,s);if(N({x:n,y:a},{x:i.x,y:i.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);let l=[...o,e];this.updateGeometries(l,o[o.length-1],t.Commit),this.currentCoordinate++}registerBehaviors(e){this.coordinateSnapping=new R(e,new B(e),new L(e)),this.insertPoint=new V(e),this.clickBoundingBox=new L(e),this.pixelDistance=new B(e),this.lineSnapping=new Z(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new R(e,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start),this.lastMouseMoveEvent=e;let i=this.updateSnappedCoordinate(e)||[e.lng,e.lat];if(void 0===this.currentId||0===this.currentCoordinate)return;let o=this.store.getGeometryCopy(this.currentId).coordinates;if(o.pop(),this.closingPointId){let[t,i]=o[o.length-1],{x:r,y:s}=this.project(t,i);N({x:r,y:s},{x:e.containerX,y:e.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let r=[...o,i];if(this.insertCoordinates&&this.currentId&&this.lastCommittedCoordinates){let e=this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1];if(!Y(e,i)){let t=this.generateInsertCoordinates(e,i);r=[...this.lastCommittedCoordinates.slice(0,-1),...t,i]}}this.updateGeometries(r,void 0,t.Provisional)}onRightClick(e){let i;if(!this.editable||"started"!==this.state)return;let{featureId:o,featureCoordinateIndex:r}=this.coordinateSnapping.getSnappable(e,e=>this.lineStringFilter(e));if(!o||void 0===r)return;let s=this.store.getGeometryCopy(o);if("LineString"===s.type&&!((i=s.coordinates).length<=2)){if(i.splice(r,1),this.validate&&!this.validate({id:o,type:"Feature",geometry:s,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:o,geometry:s}]),this.onFinish(o,{mode:this.mode,action:"edit"})}}onLeftClick(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);let t=this.snapCoordinate(e)||[e.lng,e.lat];0===this.currentCoordinate?this.createLine(t):1===this.currentCoordinate&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}onClick(e){("right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))&&(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,"right"===e.button?this.onRightClick(e):"left"===e.button&&this.onLeftClick(e))}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(e,t){let i;if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)&&this.editable){if("started"===this.state){let t=this.lineSnapping.getSnappable(e,e=>this.lineStringFilter(e));t.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=t.featureCoordinateIndex,this.editedFeatureId=t.featureId,i=t.coordinate);let o=this.coordinateSnapping.getSnappable(e,e=>this.lineStringFilter(e));o.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,i=o.coordinate)}if(this.editedFeatureId&&i){if(!this.editedPointId){let[e]=this.store.create([{geometry:{type:"Point",coordinates:i},properties:{mode:this.mode,[d.EDITED]:!0}}]);this.editedPointId=e}this.setCursor(this.cursors.dragStart),t(!1)}}}onDrag(e,i){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||void 0===this.editedFeatureId||void 0===this.editedFeatureCoordinateIndex)return;let o=this.store.getGeometryCopy(this.editedFeatureId);"coordinate"===this.editedSnapType||"line"===this.editedSnapType&&void 0!==this.editedInsertIndex?o.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:"line"===this.editedSnapType&&void 0===this.editedInsertIndex&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);let r={type:"LineString",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:r,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:r}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&void 0!==this.editedFeatureId&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){let e=this.currentId,t=this.closingPointId,i=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e]),void 0!==i&&this.store.delete([i]),void 0!==t&&this.store.delete([t])}catch(e){}}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});if("Feature"===e.type&&"LineString"===e.geometry.type&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if("Feature"===e.type&&"Point"===e.geometry.type&&e.properties.mode===this.mode){let i=e.properties[d.CLOSING_POINT];return t.pointColor=this.getHexColorStylingValue(i?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(i?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=50,t}return t}validateFeature(e){return this.validateModeFeature(e,e=>(function(e,t){if("LineString"!==e.geometry.type)return{valid:!1,reason:"Feature is not a LineString"};if(e.geometry.coordinates.length<2)return{valid:!1,reason:"Feature has less than 2 coordinates"};for(let i=0;i<e.geometry.coordinates.length;i++){if(!S(e.geometry.coordinates[i]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!w(e.geometry.coordinates[i],t))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return{valid:!0}})(e,this.coordinatePrecision))}lineStringFilter(e){return!!("LineString"===e.geometry.type&&e.properties&&e.properties.mode===this.mode)}snapCoordinate(e){var t,i,o;let r;if(null!=(t=this.snapping)&&t.toLine){let t;(t=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e))&&(r=t)}return null!=(i=this.snapping)&&i.toCoordinate&&(r=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),null!=(o=this.snapping)&&o.toCustom&&(r=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),r}afterFeatureUpdated(e){this.editedFeatureId===e.id&&this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0),this.snappedPointId&&this.lastMouseMoveEvent&&this.updateSnappedCoordinate(this.lastMouseMoveEvent),this.currentId===e.id&&(this.closingPointId&&(this.store.delete([this.closingPointId]),this.closingPointId=void 0),this.currentCoordinate=0,this.currentId=void 0,"drawing"===this.state&&this.setStarted())}constructor(e){super(e,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=J,this.snapping=void 0,this.cursors=Q,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommittedCoordinates=void 0,this.snappedPointId=void 0,this.lastMouseMoveEvent=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}}let ee={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"};class et extends g{updateOptions(e){super.updateOptions(e),null!=e&&e.cursors&&(this.cursors=a({},this.cursors,e.cursors)),null!=e&&e.editable&&(this.editable=e.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){"right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(e,t){if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)){if(this.editable){let t=this.getNearestPointFeature(e);this.editedFeatureId=null==t?void 0:t.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}}onDrag(e,i){this.allowPointerEvent(this.pointerEvents.onDrag,e)&&void 0!==this.editedFeatureId&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!0}])))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&void 0!==this.editedFeatureId&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!1}]),this.editedFeatureId=void 0,t(!0))}registerBehaviors(e){this.pixelDistance=new B(e),this.clickBoundingBox=new L(e)}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});if("Feature"===e.type&&"Point"===e.geometry.type&&e.properties.mode===this.mode){let i=!!(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(i?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(i?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}validateFeature(e){return this.validateModeFeature(e,e=>{var t;return t=this.coordinatePrecision,"Point"!==e.geometry.type?{valid:!1,reason:"Feature is not a Point"}:S(e.geometry.coordinates)?w(e.geometry.coordinates,t)?{valid:!0}:{valid:!1,reason:"Feature has coordinates with excessive precision"}:{valid:!1,reason:"Feature has invalid coordinates"}})}onLeftClick(e){let i={type:"Point",coordinates:[e.lng,e.lat]},o={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:i,properties:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Finish}).valid)return;let[r]=this.store.create([{geometry:i,properties:o}]);this.onFinish(r,{mode:this.mode,action:"draw"})}onRightClick(e){if(!this.editable)return;let t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}getNearestPointFeature(e){let t=this.clickBoundingBox.create(e),i=this.store.search(t),o,r=1/0;for(let t=0;t<i.length;t++){let s=i[t];if("Point"!==s.geometry.type||s.properties.mode!==this.mode)continue;let n=this.pixelDistance.measure(e,s.geometry.coordinates);n>r||n>this.pointerDistance||(r=n,o=s)}return o}afterFeatureUpdated(e){this.editedFeatureId===e.id&&(this.editedFeatureId=void 0,this.setCursor(this.cursors.create))}constructor(e){super(e,!0),this.mode="point",this.cursors=ee,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}}class ei extends T{get ids(){return this._startEndPoints.concat()}set ids(e){}create(e,t){if(this.ids.length)throw Error("Opening and closing points already created");if(e.length<=3)throw Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:e[0]},properties:{mode:t,[d.CLOSING_POINT]:!0}},{geometry:{type:"Point",coordinates:e[e.length-2]},properties:{mode:t,[d.CLOSING_POINT]:!0}}])}delete(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}update(e){if(2!==this.ids.length)throw Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:e[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:e[e.length-3]}}])}isClosingPoint(e){let t=this.store.getGeometryCopy(this.ids[0]),i=this.store.getGeometryCopy(this.ids[1]),o=this.pixelDistance.measure(e,t.coordinates),r=this.pixelDistance.measure(e,i.coordinates);return{isClosing:o<this.pointerDistance,isPreviousClosing:r<this.pointerDistance}}constructor(e,t){super(e),this.config=void 0,this.pixelDistance=void 0,this._startEndPoints=[],this.config=e,this.pixelDistance=t}}class eo extends T{createOrUpdate(e){let t,i=this.store.getGeometryCopy(e),o=this.store.getPropertiesCopy(e);if("Polygon"===i.type)t=i.coordinates[0].slice(0,-1);else{if("LineString"!==i.type)return;t=i.coordinates}let r=this.store.getPropertiesCopy(e),s=r.coordinatePointIds;if(s)if(s&&s.every(e=>this.store.has(e))){let i=r.coordinatePointIds,s=i.map(e=>this.store.getGeometryCopy(e).coordinates);if(i.length!==t.length){this.deleteCoordinatePoints(i);let r=this.createPoints(t,o.mode,e);this.setFeatureCoordinatePoints(e,r)}else t.forEach((e,t)=>{e[0]===s[t][0]&&e[1]===s[t][1]||this.store.updateGeometry([{id:i[t],geometry:{type:"Point",coordinates:e}}])})}else{let i=s.filter(e=>this.store.has(e));i.length&&this.deleteCoordinatePoints(i);let r=this.createPoints(t,o.mode,e);this.setFeatureCoordinatePoints(e,r)}else{let i=this.createPoints(t,o.mode,e);this.setFeatureCoordinatePoints(e,i)}}deletePointsByFeatureIds(e){for(let t of e)this.deleteIfPresent(t)}getUpdated(e,t){let i=this.store.getPropertiesCopy(e);if(i.coordinatePointIds)return i.coordinatePointIds.map((e,i)=>({id:e,geometry:a({},this.store.getGeometryCopy(e),{coordinates:t[i]})}))}createPoints(e,t,i){return this.store.create(e.map((e,o)=>({geometry:{type:"Point",coordinates:e},properties:{mode:t,[d.COORDINATE_POINT]:!0,[d.COORDINATE_POINT_FEATURE_ID]:i,index:o}})))}setFeatureCoordinatePoints(e,t){this.store.updateProperty([{id:e,property:d.COORDINATE_POINT_IDS,value:t}])}deleteCoordinatePoints(e){let t=e.filter(e=>this.store.has(e));this.store.delete(t)}deleteIfPresent(e){let t=this.store.getPropertiesCopy(e).coordinatePointIds;t&&(this.deleteCoordinatePoints(t),this.setFeatureCoordinatePoints(e,null))}constructor(e){super(e)}}let er={cancel:"Escape",finish:"Enter"},es={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class en extends g{updateOptions(e){if(super.updateOptions(e),null!=e&&e.cursors&&(this.cursors=a({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=a({},this.keyEvents,e.keyEvents)),null!=e&&e.snapping&&(this.snapping=e.snapping),void 0!==(null==e?void 0:e.editable)&&(this.editable=e.editable),void 0!==(null==e?void 0:e.pointerEvents)&&(this.pointerEvents=e.pointerEvents),void 0!==(null==e?void 0:e.showCoordinatePoints)){if(this.showCoordinatePoints=e.showCoordinatePoints,this.coordinatePoints&&!0===e.showCoordinatePoints)this.store.copyAllWhere(e=>e.mode===this.mode).map(e=>e.id).forEach(e=>{this.coordinatePoints.createOrUpdate(e)});else if(this.coordinatePoints&&!1===this.showCoordinatePoints){let e=this.store.copyAllWhere(e=>e.mode===this.mode&&!!e[d.COORDINATE_POINT_IDS]);this.coordinatePoints.deletePointsByFeatureIds(e.map(e=>e.id))}}}close(){if(void 0===this.currentId)return;let e=this.store.getGeometryCopy(this.currentId).coordinates[0];if(e.length<5||!this.updatePolygonGeometry([...e.slice(0,-2),e[0]],t.Finish))return;let i=this.currentId;if(this.currentId){let e=O(this.store.getGeometryCopy(this.currentId));e&&(this.store.updateGeometry([{id:this.currentId,geometry:e}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId)),this.store.updateProperty([{id:this.currentId,property:d.CURRENTLY_DRAWING,value:void 0},{id:this.currentId,property:d.COMMITTED_COORDINATE_COUNT,value:void 0},{id:this.currentId,property:d.PROVISIONAL_COORDINATE_COUNT,value:void 0}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),"drawing"===this.state&&this.setStarted(),this.onFinish(i,{mode:this.mode,action:"draw"})}registerBehaviors(e){this.clickBoundingBox=new L(e),this.pixelDistance=new B(e),this.lineSnapping=new Z(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new R(e,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new ei(e,this.pixelDistance),this.coordinatePoints=new eo(e)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}updateSnappedCoordinate(e){let t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{let[e]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[d.SNAPPING_POINT]:!0}}]);this.snappedPointId=e}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0)}onMouseMove(e){let i;if(this.mouseMove=!0,this.setCursor(this.cursors.start),this.lastMouseMoveEvent=e,this.updateSnappedCoordinate(e),void 0===this.currentId||0===this.currentCoordinate)return;let o=this.store.getGeometryCopy(this.currentId).coordinates[0];if(1===this.currentCoordinate){let t=Math.max(1e-6,1/Math.pow(10,this.coordinatePrecision-1));i=[o[0],[e.lng,e.lat],[e.lng,e.lat-t],o[0]]}else if(2===this.currentCoordinate)i=[o[0],o[1],[e.lng,e.lat],o[0]];else{let{isClosing:t,isPreviousClosing:r}=this.closingPoints.isClosingPoint(e);r||t?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),i=[...o.slice(0,-2),o[0],o[0]]):i=[...o.slice(0,-2),[e.lng,e.lat],o[0]]}this.store.updateProperty([{id:this.currentId,property:d.PROVISIONAL_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.updatePolygonGeometry(i,t.Provisional)}updatePolygonGeometry(e,t){if(!this.currentId)return!1;let i={type:"Polygon",coordinates:[e]};return!(this.validate&&!this.validate({type:"Feature",geometry:i},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:i}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId),0))}snapCoordinate(e){var t,i,o;let r;if(null!=(t=this.snapping)&&t.toLine){let t;(t=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e))&&(r=t)}if(null!=(i=this.snapping)&&i.toCoordinate){let t;(t=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e))&&(r=t)}return null!=(o=this.snapping)&&o.toCustom&&(r=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),r}polygonFilter(e){return!!("Polygon"===e.geometry.type&&e.properties&&e.properties.mode===this.mode)}onRightClick(e){let i;if(!this.editable||"started"!==this.state)return;let{featureId:o,featureCoordinateIndex:r}=this.coordinateSnapping.getSnappable(e,e=>this.polygonFilter(e));if(!o||void 0===r)return;let s=this.store.getGeometryCopy(o);"Polygon"===s.type&&((i=s.coordinates[0]).length<=4||("Polygon"!==s.type||0!==r&&r!==i.length-1?i.splice(r,1):(i.shift(),i.pop(),i.push([i[0][0],i[0][1]])),(!this.validate||this.validate({id:o,type:"Feature",geometry:s,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:o,geometry:s}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(o),this.onFinish(o,{mode:this.mode,action:"edit"}))))}onLeftClick(e){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),0===this.currentCoordinate){let t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);let[i]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[d.CURRENTLY_DRAWING]:!0,[d.COMMITTED_COORDINATE_COUNT]:this.currentCoordinate+1,[d.PROVISIONAL_COORDINATE_COUNT]:this.currentCoordinate+1}}]);this.currentId=i,this.currentCoordinate++,this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(i),this.setDrawing()}else if(1===this.currentCoordinate&&this.currentId){let i=this.snapCoordinate(e);i&&(e.lng=i[0],e.lat=i[1]);let o=this.store.getGeometryCopy(this.currentId);if(Y([e.lng,e.lat],o.coordinates[0][0])||!this.updatePolygonGeometry([o.coordinates[0][0],[e.lng,e.lat],[e.lng,e.lat],o.coordinates[0][0]],t.Commit))return;this.store.updateProperty([{id:this.currentId,property:d.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++}else if(2===this.currentCoordinate&&this.currentId){let i=this.snapCoordinate(e);i&&(e.lng=i[0],e.lat=i[1]);let o=this.store.getGeometryCopy(this.currentId).coordinates[0];if(Y([e.lng,e.lat],o[1])||!this.updatePolygonGeometry([o[0],o[1],[e.lng,e.lat],[e.lng,e.lat],o[0]],t.Commit))return;2===this.currentCoordinate&&this.closingPoints.create(o,"polygon"),this.store.updateProperty([{id:this.currentId,property:d.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++}else if(this.currentId){let i=this.store.getGeometryCopy(this.currentId).coordinates[0],{isClosing:o,isPreviousClosing:r}=this.closingPoints.isClosingPoint(e);if(r||o)this.close();else{let o=this.snapCoordinate(e);if(o&&(e.lng=o[0],e.lat=o[1]),Y([e.lng,e.lat],i[this.currentCoordinate-1]))return;let r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[[0,0],[0,1],[1,1],[1,0],[0,0]]];return{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}([[...i.slice(0,-1),[e.lng,e.lat],i[0]]]);if(!this.updatePolygonGeometry(r.geometry.coordinates[0],t.Commit))return;this.store.updateProperty([{id:this.currentId,property:d.COMMITTED_COORDINATE_COUNT,value:this.currentCoordinate+1}]),this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(r.geometry.coordinates[0])}}}onClick(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,"right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onKeyDown(){}onDragStart(e,t){let i;if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)&&this.editable){if("started"===this.state){let t=this.lineSnapping.getSnappable(e,e=>this.polygonFilter(e));t.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=t.featureCoordinateIndex,this.editedFeatureId=t.featureId,i=t.coordinate);let o=this.coordinateSnapping.getSnappable(e,e=>this.polygonFilter(e));o.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,i=o.coordinate)}if(this.editedFeatureId&&i){if(!this.editedPointId){let[e]=this.store.create([{geometry:{type:"Point",coordinates:i},properties:{mode:this.mode,[d.EDITED]:!0}}]);this.editedPointId=e}this.setCursor(this.cursors.dragStart),t(!1)}}}onDrag(e,i){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||void 0===this.editedFeatureId||void 0===this.editedFeatureCoordinateIndex)return;let o=this.store.getGeometryCopy(this.editedFeatureId),r=o.coordinates[0];"coordinate"===this.editedSnapType||"line"===this.editedSnapType&&void 0!==this.editedInsertIndex?0===this.editedFeatureCoordinateIndex||this.editedFeatureCoordinateIndex===o.coordinates[0].length-1?(r[0]=[e.lng,e.lat],r[r.length-1]=[e.lng,e.lat]):r[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:"line"===this.editedSnapType&&void 0===this.editedInsertIndex&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates[0].splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);let s={type:"Polygon",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:s,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:s}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.editedFeatureId),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&void 0!==this.editedFeatureId&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:d.EDITED,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){let e=this.currentId,t=this.snappedPointId,i=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted();try{e&&this.coordinatePoints.deletePointsByFeatureIds([e]),void 0!==e&&this.store.delete([e]),void 0!==i&&this.store.delete([i]),void 0!==t&&this.store.delete([t]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(e){}}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});if(e.properties.mode===this.mode){if("Polygon"===e.geometry.type)return t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if("Point"===e.geometry.type){let i=e.properties[d.EDITED],o=e.properties[d.COORDINATE_POINT],r=i?"editedPoint":e.properties[d.CLOSING_POINT]?"closingPoint":e.properties[d.SNAPPING_POINT]?"snappingPoint":o?"coordinatePoint":void 0;if(!r)return t;let s={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth},coordinatePoint:{width:this.styles.coordinatePointWidth,color:this.styles.coordinatePointColor,outlineColor:this.styles.coordinatePointOutlineColor,outlineWidth:this.styles.coordinatePointOutlineWidth}};return t.pointWidth=this.getNumericStylingValue(s[r].width,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(s[r].color,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(s[r].outlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(s[r].outlineWidth,2,e),t.zIndex=i?40:o?20:30,t}}return t}afterFeatureAdded(e){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(e.id)}afterFeatureUpdated(e){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(e.id),this.editedFeatureId===e.id&&this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0),this.snappedPointId&&this.lastMouseMoveEvent&&this.updateSnappedCoordinate(this.lastMouseMoveEvent),this.currentId===e.id&&(this.currentCoordinate=0,this.currentId=void 0,this.closingPoints.delete(),"drawing"===this.state&&this.setStarted())}validateFeature(e){return this.validateModeFeature(e,e=>j(e,this.coordinatePrecision))}constructor(e){super(e,!0),this.mode="polygon",this.currentCoordinate=0,this.currentId=void 0,this.keyEvents=er,this.cursors=es,this.mouseMove=!1,this.showCoordinatePoints=!1,this.lastMouseMoveEvent=void 0,this.snapping=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinatePoints=void 0,this.lineSnapping=void 0,this.coordinateSnapping=void 0,this.pixelDistance=void 0,this.closingPoints=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}}let ea={cancel:"Escape",finish:"Enter"},el={start:"crosshair"};class ed extends g{updateOptions(e){super.updateOptions(e),null!=e&&e.cursors&&(this.cursors=a({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=a({},this.keyEvents,e.keyEvents))}updateRectangle(e,t){if(1===this.clickCount&&this.center&&this.currentRectangleId){let i=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],o={type:"Polygon",coordinates:[[i,[e.lng,i[1]],[e.lng,e.lat],[i[0],e.lat],i]]};(!this.validate||this.validate({id:this.currentRectangleId,geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid)&&this.store.updateGeometry([{id:this.currentRectangleId,geometry:o}])}}close(){let e=this.currentRectangleId;if(e){let t=O(this.store.getGeometryCopy(e));t&&this.store.updateGeometry([{id:e,geometry:t}]),this.store.updateProperty([{id:e,property:d.CURRENTLY_DRAWING,value:void 0}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),void 0!==e&&this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if("right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(0===this.clickCount){this.center=[e.lng,e.lat];let[t]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[d.CURRENTLY_DRAWING]:!0}}]);this.currentRectangleId=t,this.clickCount++,this.setDrawing()}else this.updateRectangle(e,t.Finish),this.close()}onMouseMove(e){this.updateRectangle(e,t.Provisional)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){let e=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),void 0!==e&&this.store.delete([e])}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});return"Feature"===e.type&&"Polygon"===e.geometry.type&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10),t}validateFeature(e){return this.validateModeFeature(e,e=>_(e,this.coordinatePrecision))}afterFeatureUpdated(e){this.currentRectangleId===e.id&&(this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted())}constructor(e){super(e,!0),this.mode="rectangle",this.center=void 0,this.clickCount=0,this.currentRectangleId=void 0,this.keyEvents=ea,this.cursors=el,this.updateOptions(e)}}function ec(e,t){let i=f(e[1]),o=f(t[1]),r=f(t[0]-e[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);let s=(v(Math.atan2(r,Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4))))+360)%360;return s>180?-(360-s):s}function eh(e,t,i){let o=t;t<0&&(o=-Math.abs(o));let r=o/6371008.8,s=e[0]*Math.PI/180,n=f(e[1]),a=f(i),l=r*Math.cos(a),d=n+l;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);let c=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),h=[(180*(s+r*Math.sin(a)/(Math.abs(c)>1e-11?l/c:Math.cos(n)))/Math.PI+540)%360-180,180*d/Math.PI];return h[0]+=h[0]-e[0]>180?-360:360*(e[0]-h[0]>180),h}function eu(e){let{featureCoords:t,precision:i,unproject:o,project:r,projection:s}=e,n=[];for(let e=0;e<t.length-1;e++){let a;if("web-mercator"===s)a=function(e,t,i,o,r){let s=o(e[0],e[1]),n=o(t[0],t[1]),{lng:a,lat:l}=r((s.x+n.x)/2,(s.y+n.y)/2);return[x(a,i),x(l,i)]}(t[e],t[e+1],i,r,o);else{if("globe"!==s)throw Error("Invalid projection");a=function(e,t,i){let o=eh(e,1e3*y(e,t)/2,ec(e,t));return[x(o[0],i),x(o[1],i)]}(t[e],t[e+1],i)}n.push(a)}return n}class ep extends T{get ids(){return this._midPoints.concat()}set ids(e){}insert(e,t,i){let o=this.store.getGeometryCopy(t),{midPointFeatureId:r,midPointSegment:s}=this.store.getPropertiesCopy(t),n=this.store.getGeometryCopy(r),a="Polygon"===n.type?n.coordinates[0]:n.coordinates;a.splice(s+1,0,o.coordinates),n.coordinates="Polygon"===n.type?[a]:a,this.store.updateGeometry([{id:r,geometry:n}]),this.store.getPropertiesCopy(e)[d.COORDINATE_POINT_IDS]&&this.coordinatePointBehavior.createOrUpdate(e),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(a,r,i),this.selectionPointBehavior.create(a,n.type,r)}create(e,t,i){var o,r;if(!this.store.has(t))throw Error("Store does not have feature with this id");this._midPoints=this.store.create((o=e=>({mode:this.mode,[l.MID_POINT]:!0,midPointSegment:e,midPointFeatureId:t}),r=this.config.project,eu({featureCoords:e,precision:i,project:r,unproject:this.config.unproject,projection:this.projection}).map((e,t)=>({geometry:{type:"Point",coordinates:e},properties:o(t)}))))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(0!==this._midPoints.length)return eu({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((e,t)=>({id:this._midPoints[t],geometry:{type:"Point",coordinates:e}}))}constructor(e,t,i){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=t,this.coordinatePointBehavior=i}}class eg extends T{get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,t,i){this._selectionPoints=this.store.create(function(e,t,i){let o=[],r="Polygon"===t?e.length-1:e.length;for(let t=0;t<r;t++)o.push({geometry:{type:"Point",coordinates:e[t]},properties:i(t)});return o}(e,t,e=>({mode:this.mode,index:e,[l.SELECTION_POINT]:!0,[l.SELECTION_POINT_FEATURE_ID]:i})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(0!==this._selectionPoints.length)return this._selectionPoints.map((t,i)=>({id:t,geometry:{type:"Point",coordinates:e[i]}}))}getOneUpdated(e,t){if(void 0!==this._selectionPoints[e])return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}constructor(e){super(e),this._selectionPoints=[]}}function em(e,t){var i,o;let r=!1;for(let s=0,n=t.length;s<n;s++){let n=t[s];for(let t=0,s=n.length,a=s-1;t<s;a=t++)(i=n[t])[1]>e[1]!=(o=n[a])[1]>e[1]&&e[0]<(o[0]-i[0])*(e[1]-i[1])/(o[1]-i[1])+i[0]&&(r=!r)}return r}let ey=(e,t,i)=>{let o=(e,t)=>(e=>e*e)(e.x-t.x)+(e=>e*e)(e.y-t.y);return Math.sqrt(((e,t,i)=>{let r=o(t,i);if(0===r)return o(e,t);let s=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return s=Math.max(0,Math.min(1,s)),o(e,{x:t.x+s*(i.x-t.x),y:t.y+s*(i.y-t.y)})})(e,t,i))};class ef extends T{find(e,t){let i,o,r,s,n=1/0,a=1/0,d=1/0,c=this.createClickBoundingBox.create(e),h=this.store.search(c);for(let c=0;c<h.length;c++){let u=h[c],p=u.geometry;if("Point"===p.type){if(u.properties.selectionPoint||u.properties.coordinatePoint||!t&&u.properties[l.MID_POINT])continue;let o=this.pixelDistance.measure(e,p.coordinates);u.properties[l.MID_POINT]&&o<this.pointerDistance&&o<d?(d=o,r=u):!u.properties[l.MID_POINT]&&o<this.pointerDistance&&o<n&&(n=o,i=u)}else if("LineString"===p.type){if(i)continue;for(let t=0;t<p.coordinates.length-1;t++){let i=p.coordinates[t],r=p.coordinates[t+1],s=ey({x:e.containerX,y:e.containerY},this.project(i[0],i[1]),this.project(r[0],r[1]));s<this.pointerDistance&&s<a&&(a=s,o=u)}}else if("Polygon"===p.type){if(i||o)continue;em([e.lng,e.lat],p.coordinates)&&(s=u)}}return{clickedFeature:i||o||s,clickedMidPoint:r}}constructor(e,t,i){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=t,this.pixelDistance=i}}class ev extends T{startDragging(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return null!==this.draggedFeatureId}canDrag(e,t){let{clickedFeature:i}=this.featuresAtCursorEvent.find(e,!0);return!(!i||i.id!==t)}drag(e,i){if(!this.draggedFeatureId)return;let o=this.store.getGeometryCopy(this.draggedFeatureId),r=[e.lng,e.lat];if("Polygon"===o.type||"LineString"===o.type){let s,n;if(n="Polygon"===o.type?(s=o.coordinates[0]).length-1:(s=o.coordinates).length,!this.dragPosition)return!1;for(let e=0;e<n;e++){let t,i,o=s[e];if("web-mercator"===this.config.projection){let e=C(this.dragPosition[0],this.dragPosition[1]),s=C(r[0],r[1]),n=C(o[0],o[1]),a={x:e.x-s.x,y:e.y-s.y},{lng:l,lat:d}=P(n.x-a.x,n.y-a.y);t=l,i=d}else{let e=[this.dragPosition[0]-r[0],this.dragPosition[1]-r[1]];t=o[0]-e[0],i=o[1]-e[1]}if(t=x(t,this.config.coordinatePrecision),i=x(i,this.config.coordinatePrecision),t>180||t<-180||i>90||i<-90)return!1;s[e]=[t,i]}"Polygon"===o.type&&(s[s.length-1]=[s[0][0],s[0][1]]);let a=this.selectionPoints.getUpdated(s)||[],l=this.midPoints.getUpdated(s)||[],d=this.coordinatePoints.getUpdated(this.draggedFeatureId,s)||[];if(i&&!i({type:"Feature",id:this.draggedFeatureId,geometry:o,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:t.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o},...a,...l,...d]),this.dragPosition=[e.lng,e.lat]}else"Point"===o.type&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:r}}]),this.dragPosition=[e.lng,e.lat])}constructor(e,t,i,o,r){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=t,this.selectionPoints=i,this.midPoints=o,this.coordinatePoints=r}}class ex extends T{getClosestCoordinate(e,t){let i,o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};if("LineString"===t.type)i=t.coordinates;else{if("Polygon"!==t.type)return o;i=t.coordinates[0]}for(let r=0;r<i.length;r++){let s=this.pixelDistance.measure(e,i[r]);if(s<this.pointerDistance&&s<o.dist){let e="Polygon"===t.type&&(r===i.length-1||0===r);o.dist=s,o.index=e?0:r,o.isFirstOrLastPolygonCoord=e}}return o}getDraggableIndex(e,t){let i=this.store.getGeometryCopy(t),o=this.getClosestCoordinate(e,i);return -1===o.index?-1:o.index}snapCoordinate(e,t,i){let o=[e.lng,e.lat],r=e=>!!(e.properties&&e.properties.mode===i.properties.mode&&e.id!==this.draggedCoordinate.id);if(null!=t&&t.toLine){let t;(t=this.lineSnapping.getSnappable(e,r).coordinate)&&(o=t)}if(t.toCoordinate){let t;(t=this.coordinateSnapping.getSnappable(e,r).coordinate)&&(o=t)}if(null!=t&&t.toCustom){let r;(r=t.toCustom(e,{currentCoordinate:this.draggedCoordinate.index,currentId:i.id,getCurrentGeometrySnapshot:i.id?()=>this.store.getGeometryCopy(i.id):()=>null,project:this.project,unproject:this.unproject}))&&(o=r)}return o}drag(e,i,o,r){let s=this.draggedCoordinate.id;if(null===s)return!1;let n=this.draggedCoordinate.index,a=this.store.getGeometryCopy(s),l=this.store.getPropertiesCopy(s),d="LineString"===a.type?a.coordinates:a.coordinates[0],c="Polygon"===a.type&&(n===d.length-1||0===n),h={type:"Feature",id:s,geometry:a,properties:l},u=this.snapCoordinate(e,r,h);if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(c){let e=d.length-1;d[0]=u,d[e]=u}else d[n]=u;let p=this.selectionPoints.getOneUpdated(n,u),g=this.midPoints.getUpdated(d)||[],m=this.coordinatePoints.getUpdated(s,d)||[];return!("Point"!==a.type&&!i&&I({type:"Feature",geometry:a,properties:{}})||o&&!o(h,{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:t.Provisional}).valid||(this.store.updateGeometry([{id:s,geometry:a},...p?[p]:[],...g,...m]),0))}isDragging(){return null!==this.draggedCoordinate.id}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}constructor(e,t,i,o,r,s,n){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.lineSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=o,this.coordinatePoints=r,this.coordinateSnapping=s,this.lineSnapping=n}}function eC(e){let t=0,i=0,o=0;return("Polygon"===e.geometry.type?e.geometry.coordinates[0].slice(0,-1):e.geometry.coordinates).forEach(e=>{t+=e[0],i+=e[1],o++},!0),[t/o,i/o]}let eP=(e,t)=>{if(0===t||360===t||-360===t)return e;let i=.017453292519943295*t,o=("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).map(e=>{let[t,i]=e;return C(t,i)}),r=o.reduce((e,t)=>({x:e.x+t.x,y:e.y+t.y}),{x:0,y:0});r.x/=o.length,r.y/=o.length;let s=o.map(e=>({x:r.x+(e.x-r.x)*Math.cos(i)-(e.y-r.y)*Math.sin(i),y:r.y+(e.x-r.x)*Math.sin(i)+(e.y-r.y)*Math.cos(i)})).map(e=>{let{x:t,y:i}=e;return[P(t,i).lng,P(t,i).lat]});return"Polygon"===e.geometry.type?e.geometry.coordinates[0]=s:e.geometry.coordinates=s,e};function eb(e){let t=("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).map(e=>{let{x:t,y:i}=C(e[0],e[1]);return[t,i]});return"Polygon"===e.geometry.type?function(e){let t=0,i=0,o=0,r=e.length;for(let s=0;s<r-1;s++){let[r,n]=e[s],[a,l]=e[s+1],d=r*l-a*n;t+=d,i+=(r+a)*d,o+=(n+l)*d}return t/=2,{x:i/=6*t,y:o/=6*t}}(t):function(e){let t=e.length,i=0,o=0;for(let r=0;r<t;r++){let[t,s]=e[r];i+=t,o+=s}return{x:i/t,y:o/t}}(t)}class eI extends T{reset(){this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.selectedGeometryCentroid=void 0}rotate(e,i,o){let r;this.selectedGeometry||(this.selectedGeometry=this.store.getGeometryCopy(i));let s=this.selectedGeometry;if("Polygon"!==s.type&&"LineString"!==s.type)return;let n=[e.lng,e.lat],a={type:"Feature",geometry:s,properties:{}};if("web-mercator"===this.config.projection){this.selectedGeometryWebMercatorCentroid||(this.selectedGeometryWebMercatorCentroid=eb(a));let t=C(e.lng,e.lat);if(0===(r=function(e,t){let{x:i,y:o}=e,{x:r,y:s}=t,n=r-i,a=s-o;if(0===n&&0===a)return 0;let l=Math.atan2(a,n);return(l*=180/Math.PI)>180?l-=360:l<-180&&(l+=360),l}(this.selectedGeometryWebMercatorCentroid,t)))return;if(!this.lastBearing)return void(this.lastBearing=r);eP(a,-(this.lastBearing-r))}else{if("globe"!==this.config.projection)throw Error("Unsupported projection");if(this.selectedGeometryCentroid||(this.selectedGeometryCentroid=eC({type:"Feature",geometry:s,properties:{}})),r=ec(this.selectedGeometryCentroid,n),!this.lastBearing)return void(this.lastBearing=r+180);!function(e,t){if(0===t||360===t||-360===t)return;let i=eC(e);("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).forEach(e=>{let o=ec(i,e)+t,r=function(e,t){e[0]+=e[0]-t[0]>180?-360:360*(t[0]-e[0]>180);let i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,r=o-i,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);let n=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),a=Math.abs(n)>1e-11?r/n:Math.cos(i);return 6371008.8*Math.sqrt(r*r+a*a*s*s)}(i,e),s=eh(i,r,o);e[0]=s[0],e[1]=s[1]})}(a,-(this.lastBearing-(r+180)))}let l="Polygon"===s.type?s.coordinates[0]:s.coordinates;l.forEach(e=>{e[0]=x(e[0],this.coordinatePrecision),e[1]=x(e[1],this.coordinatePrecision)});let d=this.midPoints.getUpdated(l)||[],c=this.selectionPoints.getUpdated(l)||[],h=this.coordinatePoints.getUpdated(i,l)||[];if(o&&!o({id:i,type:"Feature",geometry:s,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:t.Provisional}))return!1;this.store.updateGeometry([{id:i,geometry:s},...c,...d,...h]),"web-mercator"===this.projection?this.lastBearing=r:"globe"===this.projection&&(this.lastBearing=r+180)}constructor(e,t,i,o){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryCentroid=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.config=e,this.selectionPoints=t,this.midPoints=i,this.coordinatePoints=o}}class eM extends T{scale(e,t,i){if(!this.dragCoordinateResizeBehavior.isDragging()){let i=this.dragCoordinateResizeBehavior.getDraggableIndex(e,t);this.dragCoordinateResizeBehavior.startDragging(t,i)}this.dragCoordinateResizeBehavior.drag(e,"center-fixed",i)}reset(){this.dragCoordinateResizeBehavior.stopDragging()}constructor(e,t){super(e),this.config=void 0,this.dragCoordinateResizeBehavior=void 0,this.config=e,this.dragCoordinateResizeBehavior=t}}function ew(e){let{coordinates:t,originX:i,originY:o,xScale:r,yScale:s}=e;1===r&&1===s||t.forEach(e=>{let{x:t,y:n}=C(e[0],e[1]),{lng:a,lat:l}=P(i+(t-i)*r,o+(n-o)*s);e[0]=a,e[1]=l})}class eS extends T{getClosestCoordinate(e,t){let i,o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};if("LineString"===t.type)i=t.coordinates;else{if("Polygon"!==t.type)return o;i=t.coordinates[0]}for(let r=0;r<i.length;r++){let s=this.pixelDistance.measure(e,i[r]);if(s<this.pointerDistance&&s<o.dist){let e="Polygon"===t.type&&(r===i.length-1||0===r);o.dist=s,o.index=e?0:r,o.isFirstOrLastPolygonCoord=e}}return o}isValidDragWebMercator(e,t,i){switch(e){case 0:if(t<=0||i>=0)return!1;break;case 1:if(i>=0)return!1;break;case 2:if(t>=0||i>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||i<=0)return!1;break;case 5:if(i<=0)return!1;break;case 6:if(t<=0||i<=0)return!1;break;case 7:if(t<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||-1===this.draggedCoordinate.index)return null;let e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;let t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){let t=this.getSelectedFeatureDataWebMercator();if(!t)return null;let{feature:i,boundingBox:o,updatedCoords:r,selectedCoordinate:s}=t,n=eb(i);if(!n)return null;let a=C(s[0],s[1]),{closestBBoxIndex:l}=this.getIndexesWebMercator(o,a),d=C(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:r,webMercatorCursor:d,webMercatorSelected:a,webMercatorOrigin:n}),r}centerFixedWebMercatorDrag(e){let t=this.getSelectedFeatureDataWebMercator();if(!t)return null;let{feature:i,boundingBox:o,updatedCoords:r,selectedCoordinate:s}=t,n=eb(i);if(!n)return null;let a=C(s[0],s[1]),{closestBBoxIndex:l}=this.getIndexesWebMercator(o,a),d=C(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:r,webMercatorCursor:d,webMercatorSelected:a,webMercatorOrigin:n}),r}scaleFixedWebMercator(e){let{closestBBoxIndex:t,webMercatorOrigin:i,webMercatorSelected:o,webMercatorCursor:r,updatedCoords:s}=e;if(!this.isValidDragWebMercator(t,i.x-r.x,i.y-r.y))return null;let n=N(i,r)/N(i,o);return n<0&&(n=this.minimumScale),ew({coordinates:s,originX:i.x,originY:i.y,xScale:n,yScale:n}),s}oppositeFixedWebMercatorDrag(e){let t=this.getSelectedFeatureDataWebMercator();if(!t)return null;let{boundingBox:i,updatedCoords:o,selectedCoordinate:r}=t,s=C(r[0],r[1]),{oppositeBboxIndex:n,closestBBoxIndex:a}=this.getIndexesWebMercator(i,s),l={x:i[n][0],y:i[n][1]},d=C(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:a,updatedCoords:o,webMercatorCursor:d,webMercatorSelected:s,webMercatorOrigin:l}),o}oppositeWebMercatorDrag(e){let t=this.getSelectedFeatureDataWebMercator();if(!t)return null;let{boundingBox:i,updatedCoords:o,selectedCoordinate:r}=t,s=C(r[0],r[1]),{oppositeBboxIndex:n,closestBBoxIndex:a}=this.getIndexesWebMercator(i,s),l={x:i[n][0],y:i[n][1]},d=C(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:a,updatedCoords:o,webMercatorCursor:d,webMercatorSelected:s,webMercatorOrigin:l}),o}scaleWebMercator(e){let{closestBBoxIndex:t,webMercatorOrigin:i,webMercatorSelected:o,webMercatorCursor:r,updatedCoords:s}=e,n=i.x-r.x,a=i.y-r.y;if(!this.isValidDragWebMercator(t,n,a))return null;let l=1;0!==n&&1!==t&&5!==t&&(l=1-(i.x-o.x-n)/n);let d=1;return 0!==a&&3!==t&&7!==t&&(d=1-(i.y-o.y-a)/a),this.validateScale(l,d)?(l<0&&(l=this.minimumScale),d<0&&(d=this.minimumScale),this.performWebMercatorScale(s,i.x,i.y,l,d),s):null}getFeature(e){if(null===this.draggedCoordinate.id)return null;let t=this.store.getGeometryCopy(e);return"Polygon"!==t.type&&"LineString"!==t.type?null:{id:e,type:"Feature",geometry:t,properties:{}}}getNormalisedCoordinates(e){return"Polygon"===e.type?e.coordinates[0]:e.coordinates}validateScale(e,t){let i=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,o=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return i&&o}performWebMercatorScale(e,t,i,o,r){e.forEach(e=>{let{x:s,y:n}=C(e[0],e[1]),{lng:a,lat:l}=P(t+(s-t)*o,i+(n-i)*r);e[0]=a,e[1]=l})}getBBoxWebMercator(e){let t=[1/0,1/0,-1/0,-1/0];(e=e.map(e=>{let{x:t,y:i}=C(e[0],e[1]);return[t,i]})).forEach(e=>{let[i,o]=e;i<t[0]&&(t[0]=i),o<t[1]&&(t[1]=o),i>t[2]&&(t[2]=i),o>t[3]&&(t[3]=o)});let[i,o,r,s]=t;return[[i,s],[(i+r)/2,s],[r,s],[r,s+(o-s)/2],[r,o],[(i+r)/2,o],[i,o],[i,s+(o-s)/2]]}getIndexesWebMercator(e,t){let i,o=1/0;for(let r=0;r<e.length;r++){let s=N({x:t.x,y:t.y},{x:e[r][0],y:e[r][1]});s<o&&(i=r,o=s)}if(void 0===i)throw Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[i],closestBBoxIndex:i}}isDragging(){return null!==this.draggedCoordinate.id}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,t){let i=this.store.getGeometryCopy(t),o=this.getClosestCoordinate(e,i);return -1===o.index?-1:o.index}drag(e,i,o){if(!this.draggedCoordinate.id)return!1;let r=this.getFeature(this.draggedCoordinate.id);if(!r)return!1;let s=null;if("center"===i?s=this.centerWebMercatorDrag(e):"opposite"===i?s=this.oppositeWebMercatorDrag(e):"center-fixed"===i?s=this.centerFixedWebMercatorDrag(e):"opposite-fixed"===i&&(s=this.oppositeFixedWebMercatorDrag(e)),!s)return!1;for(let e=0;e<s.length;e++){let t=s[e];if(t[0]=x(t[0],this.coordinatePrecision),t[1]=x(t[1],this.coordinatePrecision),!w(t,this.coordinatePrecision))return!1}let n=this.midPoints.getUpdated(s)||[],a=this.selectionPoints.getUpdated(s)||[],l=this.coordinatePoints.getUpdated(r.id,s)||[],d={type:r.geometry.type,coordinates:"Polygon"===r.geometry.type?[s]:s};return!(o&&!o({id:this.draggedCoordinate.id,type:"Feature",geometry:d,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:t.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:d},...a,...n,...l]),0))}constructor(e,t,i,o,r){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=o,this.coordinatePoints=r}}let eE={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},ej={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class e_ extends m{updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?a({},this.cursors,e.cursors):ej,null===(null==e?void 0:e.keyEvents)?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:null!=e&&e.keyEvents&&(this.keyEvents=a({},this.keyEvents,e.keyEvents)),void 0!==(null==e?void 0:e.dragEventThrottle)&&(this.dragEventThrottle=e.dragEventThrottle),void 0!==(null==e?void 0:e.allowManualDeselection)&&(this.allowManualDeselection=e.allowManualDeselection),null!=e&&e.flags)for(let t in this.flags=a({},this.flags,e.flags),this.validations={},this.flags){let e=this.flags[t].feature;e&&e.validation&&(this.validations[t]=e.validation)}}selectFeature(e){this.select(e,!1)}setSelecting(){if("started"!==this._state)throw Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new B(e),this.clickBoundingBox=new L(e),this.featuresAtMouseEvent=new ef(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new eg(e),this.coordinatePoints=new eo(e),this.midPoints=new ep(e,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new R(e,this.pixelDistance,this.clickBoundingBox),this.lineSnap=new Z(e,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new eI(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new ev(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new ex(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap,this.lineSnap),this.dragCoordinateResizeFeature=new eS(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new eM(e,this.dragCoordinateResizeFeature)}deselectFeature(){this.deselect()}deselect(){let e=this.selected.filter(e=>this.store.has(e)).map(e=>({id:e,property:l.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){let i;if(!this.selectionPoints.ids.length)return;let o,r=1/0;if(this.selectionPoints.ids.forEach(t=>{let i=this.store.getGeometryCopy(t),s=this.pixelDistance.measure(e,i.coordinates);s<this.pointerDistance&&s<r&&(r=s,o=this.store.getPropertiesCopy(t))}),!o)return;let s=o.selectionPointFeatureId,n=o.index,a=this.store.getPropertiesCopy(s),l=this.flags[a.mode],d=this.validations[a.mode];if(!(l&&l.feature&&l.feature.coordinates&&l.feature.coordinates.deletable))return;let c=this.store.getGeometryCopy(s);if("Polygon"===c.type){if((i=c.coordinates[0]).length<=4)return}else if("LineString"===c.type&&(i=c.coordinates).length<=2)return;if(!i||("Polygon"!==c.type||0!==n&&n!==i.length-1?i.splice(n,1):(i.shift(),i.pop(),i.push([i[0][0],i[0][1]])),d&&!d({id:s,type:"Feature",geometry:c,properties:a},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t.Commit}).valid))return;let h=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(h),this.store.updateGeometry([{id:s,geometry:c}]),a.coordinatePointIds&&this.coordinatePoints.createOrUpdate(s),this.selectionPoints.create(i,c.type,s),l&&l.feature&&l.feature.coordinates&&l.feature.coordinates.midpoints&&this.midPoints.create(i,s,this.coordinatePrecision)}select(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this.selected[0]===e)return;let{mode:i}=this.store.getPropertiesCopy(e),o=this.flags[i];if(!o||!o.feature)return;let r=this.selected[0];if(r){if(r===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:l.SELECTED,value:!0}]),this.onSelect(e);let{type:s,coordinates:n}=this.store.getGeometryCopy(e);if("LineString"!==s&&"Polygon"!==s)return;let a="LineString"===s?n:n[0];a&&o&&o.feature.coordinates&&(this.selectionPoints.create(a,s,e),o.feature.coordinates.midpoints&&this.midPoints.create(a,e,this.coordinatePrecision))}onLeftClick(e){let{clickedFeature:t,clickedMidPoint:i}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&i)this.midPoints.insert(this.selected[0],i.id,this.coordinatePrecision);else if(t&&t.id)this.select(t.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){"right"===e.button&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):"left"===e.button&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(t=>e.heldKeys.includes(t))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(t=>e.heldKeys.includes(t))}preventDefaultKeyEvent(e){let t=this.canRotate(e),i=this.canScale(e);(t||i)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;let e=this.selected[0];this.onDeselect(this.selected[0]),this.coordinatePoints.deletePointsByFeatureIds([e]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.selected.length)return;let i=this.store.getPropertiesCopy(this.selected[0]),o=this.flags[i.mode];if(!(o&&o.feature&&(o.feature.draggable||o.feature.coordinates&&o.feature.coordinates.draggable||o.feature.coordinates&&o.feature.coordinates.resizable||o.feature.coordinates&&"object"==typeof o.feature.coordinates.midpoints&&o.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;let r=this.selected[0],s=this.dragCoordinate.getDraggableIndex(e,r);if(o&&o.feature&&o.feature.coordinates&&(o.feature.coordinates.draggable||o.feature.coordinates.resizable)&&-1!==s)return this.setCursor(this.cursors.dragStart),o.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(r,s):this.dragCoordinate.startDragging(r,s),void t(!1);if(o&&o.feature&&o.feature.coordinates&&"object"==typeof o.feature.coordinates.midpoints&&o.feature.coordinates.midpoints.draggable){let{clickedMidPoint:i}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&i){this.midPoints.insert(r,i.id,this.coordinatePrecision);let o=this.dragCoordinate.getDraggableIndex(e,r);return this.dragCoordinate.startDragging(r,o),void t(!1)}}return o&&o.feature&&o.feature.draggable&&this.dragFeature.canDrag(e,r)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,r),void t(!1)):void 0}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e))return;let i=this.selected[0];if(!i)return;let o=this.store.getPropertiesCopy(i),r=this.flags[o.mode],s=!0===(r&&r.feature&&r.feature.selfIntersectable);if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;let n=this.validations[o.mode];if(r&&r.feature&&r.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,i,n);if(r&&r.feature&&r.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,i,n);if(this.dragCoordinateResizeFeature.isDragging()&&r.feature&&r.feature.coordinates&&r.feature.coordinates.resizable){if("globe"===this.projection)throw Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,r.feature.coordinates.resizable,n)}if(this.dragCoordinate.isDragging()){var a;let t=null==(a=r.feature)||null==(a=a.coordinates)?void 0:a.snappable,i={toCoordinate:!1};return!0===t?i={toCoordinate:!0}:"object"==typeof t&&(i=t),void this.dragCoordinate.drag(e,s,n,i)}this.dragFeature.isDragging()?this.dragFeature.drag(e,n):t(!0)}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&(this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0))}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let t=!1;this.midPoints.ids.forEach(i=>{if(t)return;let o=this.store.getGeometryCopy(i);this.pixelDistance.measure(e,o.coordinates)<this.pointerDistance&&(t=!0)});let i=!1;if(this.selectionPoints.ids.forEach(o=>{let r=this.store.getGeometryCopy(o);this.pixelDistance.measure(e,r.coordinates)<this.pointerDistance&&(t=!1,i=!0)}),t)return void this.setCursor(this.cursors.insertMidpoint);let{clickedFeature:o}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(o&&o.id===this.selected[0]||i)?this.cursors.pointerOver:"unset")}styleFeature(e){let t=a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0});if(e.properties.mode===this.mode&&"Point"===e.geometry.type){if(e.properties[l.SELECTION_POINT])return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties[l.MID_POINT])return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=50,t}else if(e.properties[l.SELECTED]){if("Point"===e.geometry.type&&e.properties[d.MARKER])return t.markerUrl=this.getUrlStylingValue(this.styles.selectedMarkerUrl,"https://raw.githubusercontent.com/JamesLMilner/terra-draw/refs/heads/main/assets/markers/marker-blue.png",e),t.markerHeight=this.getNumericStylingValue(this.styles.selectedMarkerHeight,40,e),t.markerWidth=this.getNumericStylingValue(this.styles.selectedMarkerWidth,32,e),t;if("Polygon"===e.geometry.type)return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if("LineString"===e.geometry.type)return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if("Point"===e.geometry.type)return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=10,t}return t}afterFeatureUpdated(e){if(this.selected.length&&e.id===this.selected[0]){var t,i;let o,r=this.flags[e.properties.mode];if(null==r||null==(t=r.feature)||!t.coordinates)return;let s=e.geometry.type,n=e.id;if(this.selectionPoints.delete(),this.midPoints.delete(),"Polygon"===s)o=e.geometry.coordinates[0];else{if("LineString"!==s)return;o=e.geometry.coordinates}this.selectionPoints.create(o,s,n),null!=r&&null!=(i=r.feature)&&null!=(i=i.coordinates)&&i.midpoints&&this.midPoints.create("Polygon"===s?e.geometry.coordinates[0]:e.geometry.coordinates,n,this.coordinatePrecision)}}constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=eE,this.cursors=ej,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.lineSnap=void 0,this.updateOptions(e)}}class eD extends g{start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return a({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0})}constructor(...e){super(...e),this.type=i.Static,this.mode="static"}}function ek(e,t,i){let o=e[t];e[t]=e[i],e[i]=o}function eF(e,t){eN(e,0,e.children.length,t,e)}function eN(e,t,i,o,r){r||(r=eG([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=t;s<i;s++){let t=e.children[s];eO(r,e.leaf?o(t):t)}return r}function eO(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function eT(e,t){return e.minX-t.minX}function eA(e,t){return e.minY-t.minY}function eL(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function eB(e){return e.maxX-e.minX+(e.maxY-e.minY)}function eR(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function eW(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function eG(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eU(e,t,i,o,r){let s=[t,i];for(;s.length;){if((i=s.pop())-(t=s.pop())<=o)continue;let n=t+Math.ceil((i-t)/o/2)*o;(function e(t,i,o,r,s){for(;r>o;){if(r-o>600){let n=r-o+1,a=i-o+1,l=Math.log(n),d=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*d*(n-d)/n)*(a-n/2<0?-1:1);e(t,i,Math.max(o,Math.floor(i-a*d/n+c)),Math.min(r,Math.floor(i+(n-a)*d/n+c)),s)}let n=t[i],a=o,l=r;for(ek(t,o,i),s(t[r],n)>0&&ek(t,o,r);a<l;){for(ek(t,a,l),a++,l--;0>s(t[a],n);)a++;for(;s(t[l],n)>0;)l--}0===s(t[o],n)?ek(t,o,l):ek(t,++l,r),l<=i&&(o=l+1),i<=l&&(r=l-1)}})(e,n,t,i,r),s.push(t,n,n,i)}}class ez{search(e){let t=this.data,i=[];if(!eW(e,t))return i;let o=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){let n=t.children[s],a=t.leaf?o(n):n;eW(e,a)&&(t.leaf?i.push(n):eR(e,a)?this._all(n,i):r.push(n))}t=r.pop()}return i}collides(e){let t=this.data;if(eW(e,t)){let i=[];for(;t;){for(let o=0;o<t.children.length;o++){let r=t.children[o],s=t.leaf?this.toBBox(r):r;if(eW(e,s)){if(t.leaf||eR(e,s))return!0;i.push(r)}}t=i.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=eG([])}remove(e){let t=this.data,i=this.toBBox(e),o=[],r=[],s,n,a=!1;for(;t||o.length;){if(t||(t=o.pop(),n=o[o.length-1],s=r.pop(),a=!0),t.leaf){let i=t.children.indexOf(e);-1!==i&&(t.children.splice(i,1),o.push(t),this._condense(o))}a||t.leaf||!eR(t,i)?n?(s++,t=n.children[s],a=!1):t=null:(o.push(t),r.push(s),s=0,n=t,t=t.children[0])}}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}_all(e,t){let i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,o){let r=i-t+1,s,n=this._maxEntries;if(r<=n)return eF(s=eG(e.slice(t,i+1)),this.toBBox),s;o||(o=Math.ceil(Math.log(r)/Math.log(n)),n=Math.ceil(r/Math.pow(n,o-1))),(s=eG([])).leaf=!1,s.height=o;let a=Math.ceil(r/n),l=a*Math.ceil(Math.sqrt(n));eU(e,t,i,l,this.compareMinX);for(let r=t;r<=i;r+=l){let t=Math.min(r+l-1,i);eU(e,r,t,a,this.compareMinY);for(let i=r;i<=t;i+=a){let r=Math.min(i+a-1,t);s.children.push(this._build(e,i,r,o-1))}}return eF(s,this.toBBox),s}_chooseSubtree(e,t,i,o){for(;o.push(t),!t.leaf&&o.length-1!==i;){let i,o=1/0,r=1/0;for(let s=0;s<t.children.length;s++){let n=t.children[s],a=eL(n),l=(Math.max(n.maxX,e.maxX)-Math.min(n.minX,e.minX))*(Math.max(n.maxY,e.maxY)-Math.min(n.minY,e.minY))-a;l<r?(r=l,o=a<o?a:o,i=n):l===r&&a<o&&(o=a,i=n)}t=i||t.children[0]}return t}_insert(e,t,i){let o=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(o,this.data,t,r);for(s.children.push(e),eO(s,o);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(o,r,t)}_split(e,t){let i=e[t],o=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,o);let s=this._chooseSplitIndex(i,r,o),n=eG(i.children.splice(s,i.children.length-s));n.height=i.height,n.leaf=i.leaf,eF(i,this.toBBox),eF(n,this.toBBox),t?e[t-1].children.push(n):this._splitRoot(i,n)}_splitRoot(e,t){this.data=eG([e,t]),this.data.height=e.height+1,this.data.leaf=!1,eF(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let o,r=1/0,s=1/0;for(let n=t;n<=i-t;n++){let t=eN(e,0,n,this.toBBox),a=eN(e,n,i,this.toBBox),l=function(e,t){let i=Math.max(e.minX,t.minX),o=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-i)*Math.max(0,Math.min(e.maxY,t.maxY)-o)}(t,a),d=eL(t)+eL(a);l<r?(r=l,o=n,s=d<s?d:s):l===r&&d<s&&(s=d,o=n)}return o||i-t}_chooseSplitAxis(e,t,i){let o=e.leaf?this.compareMinX:eT,r=e.leaf?this.compareMinY:eA;this._allDistMargin(e,t,i,o)<this._allDistMargin(e,t,i,r)&&e.children.sort(o)}_allDistMargin(e,t,i,o){e.children.sort(o);let r=this.toBBox,s=eN(e,0,t,r),n=eN(e,i-t,i,r),a=eB(s)+eB(n);for(let o=t;o<i-t;o++){let t=e.children[o];eO(s,e.leaf?r(t):t),a+=eB(s)}for(let o=i-t-1;o>=t;o--){let t=e.children[o];eO(n,e.leaf?r(t):t),a+=eB(n)}return a}_adjustParentBBoxes(e,t,i){for(let o=i;o>=0;o--)eO(t[o],e)}_condense(e){for(let t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():eF(e[i],this.toBBox)}constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}}class eV{setMaps(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}toBBox(e){let t,i=[],o=[];if("Polygon"===e.geometry.type)t=e.geometry.coordinates[0];else if("LineString"===e.geometry.type)t=e.geometry.coordinates;else{if("Point"!==e.geometry.type)throw Error("Not a valid feature to turn into a bounding box");t=[e.geometry.coordinates]}for(let e=0;e<t.length;e++)o.push(t[e][1]),i.push(t[e][0]);return{minX:Math.min(...i),minY:Math.min(...o),maxX:Math.max(...i),maxY:Math.max(...o)}}insert(e){if(this.idToNode.get(String(e.id)))throw Error("Feature already exists");let t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}load(e){let t=[],i=new Set;e.forEach(e=>{let o=this.toBBox(e);if(this.setMaps(e,o),i.has(String(e.id)))throw Error("Duplicate feature ID found ".concat(e.id));i.add(String(e.id)),t.push(o)}),this.tree.load(t)}update(e){this.remove(e.id);let t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}remove(e){let t=this.idToNode.get(e);if(!t)throw Error("".concat(e," not inserted into the spatial index"));this.tree.remove(t)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(e=>this.nodeToId.get(e))}collides(e){return this.tree.collides(this.toBBox(e))}constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new ez(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}}let eY={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),isValidId:e=>"string"==typeof e&&36===e.length};class eX{clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,t,i,o){if(0===e.length)return[];let r=this.clone(e),s=[],n=[];r=r.filter(e=>{null==e.id&&(e.id=this.idStrategy.getId());let i=e.id;if(t){let o=t(e);if(!o.valid)return s.push({id:i,valid:!1,reason:o.reason}),!1}if(this.tracked){if(e.properties.createdAt){if(!u(e.properties.createdAt))return s.push({id:e.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else e.properties.createdAt=+new Date;if(e.properties.updatedAt){if(!u(e.properties.updatedAt))return s.push({id:e.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else e.properties.updatedAt=+new Date}return this.has(i)?(s.push({id:i,valid:!1,reason:"Feature already exists with this id: ".concat(i)}),!1):(this.store[i]=e,n.push(e),s.push({id:i,valid:!0}),!0)}),this.spatialIndex.load(r);let a=n.map(e=>{let{id:t}=e;return t});return a.length>0&&(this._onChange(a,"create",o),i&&n.forEach(e=>{i(e)})),s}search(e,t){let i=this.spatialIndex.search(e).map(e=>this.store[e]);return this.clone(t?i.filter(t):i)}registerOnChange(e){this._onChange=(t,i,o)=>{e(t,i,o)}}getGeometryCopy(e){let t=this.store[e];if(!t)throw Error("No feature with this id (".concat(e,"), can not get geometry copy"));return this.clone(t.geometry)}getPropertiesCopy(e){let t=this.store[e];if(!t)throw Error("No feature with this id (".concat(e,"), can not get properties copy"));return this.clone(t.properties)}updateProperty(e,t){let i=[];e.forEach(e=>{let{id:t,property:o,value:r}=e,s=this.store[t];if(!s)throw Error("No feature with this (".concat(t,"), can not update geometry"));i.push(t),void 0===r?delete s.properties[o]:s.properties[o]=r,this.tracked&&(s.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}updateGeometry(e,t){let i=[];e.forEach(e=>{let{id:t,geometry:o}=e;i.push(t);let r=this.store[t];if(!r)throw Error("No feature with this (".concat(t,"), can not update geometry"));r.geometry=this.clone(o),this.spatialIndex.update(r),this.tracked&&(r.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}create(e,t){let i=[];return e.forEach(e=>{let{geometry:t,properties:o}=e,r,s=a({},o);this.tracked&&(r=+new Date,o?(s.createdAt="number"==typeof o.createdAt?o.createdAt:r,s.updatedAt="number"==typeof o.updatedAt?o.updatedAt:r):s={createdAt:r,updatedAt:r});let n=this.getId(),l={id:n,type:"Feature",geometry:t,properties:s};this.store[n]=l,this.spatialIndex.insert(l),i.push(n)}),this._onChange&&this._onChange([...i],"create",t),i}delete(e,t){e.forEach(e=>{if(!this.store[e])throw Error("No feature with id ".concat(e,", can not delete"));delete this.store[e],this.spatialIndex.remove(e)}),this._onChange&&this._onChange([...e],"delete",t)}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}copyAllWhere(e){return this.clone(Object.keys(this.store).map(e=>this.store[e]).filter(t=>t.properties&&e(t.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new eV,this.tracked=!e||!1!==e.tracked,this.idStrategy=e&&e.idStrategy?e.idStrategy:eY}}class eK{constructor({name:e,callback:t,unregister:i,register:o}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,o(t))},this.unregister=()=>{this.register&&(this.registered=!1,i(t))},this.callback=t}}var eH={__proto__:null,GeoJSONStore:eX,TerraDrawBaseDrawMode:g,TerraDrawBaseSelectMode:m,TerraDrawBaseAdapter:class{getButton(e){return -1===e.button?"neither":0===e.button?"left":1===e.button?"middle":2===e.button?"right":"neither"}getMapElementXYPosition(e){let{left:t,top:i}=this.getMapEventElement().getBoundingClientRect();return{containerX:e.clientX-t,containerY:e.clientY-i}}getDrawEventFromEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getLngLatFromEvent(e);if(!i)return null;let{lng:o,lat:r}=i,{containerX:s,containerY:n}=this.getMapElementXYPosition(e),a=this.getButton(e),l=Array.from(this._heldKeys);return{lng:x(o,this._coordinatePrecision),lat:x(r,this._coordinatePrecision),containerX:s,containerY:n,button:a,heldKeys:l,isContextMenu:t}}register(e){this._currentModeCallbacks=e,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new eK({name:"pointerdown",callback:e=>{if(!this._currentModeCallbacks||!e.isPrimary)return;let t=this.getDrawEventFromEvent(e);t&&(this._dragState="pre-dragging",this._lastDrawEvent=t,this._lastPointerDownEventTarget=e.target?e.target:void 0)},register:e=>{this.getMapEventElement().addEventListener("pointerdown",e)},unregister:e=>{this.getMapEventElement().removeEventListener("pointerdown",e)}}),new eK({name:"pointermove",callback:e=>{if(!this._currentModeCallbacks||!e.isPrimary)return;e.preventDefault();let t=this.getDrawEventFromEvent(e);if(t)if("not-dragging"===this._dragState)this._currentModeCallbacks.onMouseMove(t),this._lastDrawEvent=t;else if("pre-dragging"===this._dragState){if(!this._lastDrawEvent)return;let e={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},i={x:t.containerX,y:t.containerY},o=this._currentModeCallbacks.getState(),r=N(e,i);if("drawing"===o?r<this._minPixelDragDistanceDrawing:"selecting"===o?r<this._minPixelDragDistanceSelecting:r<this._minPixelDragDistance)return;this._nextKeyUpIsContextMenu=!1,this._dragState="dragging",this._currentModeCallbacks.onDragStart(t,e=>{this.setDraggability.bind(this)(e)})}else"dragging"===this._dragState&&this._currentModeCallbacks.onDrag(t,e=>{this.setDraggability.bind(this)(e)})},register:e=>{this.getMapEventElement().addEventListener("pointermove",e)},unregister:e=>{this.getMapEventElement().removeEventListener("pointermove",e)}}),new eK({name:"contextmenu",callback:e=>{this._currentModeCallbacks&&(e.preventDefault(),this._nextKeyUpIsContextMenu=!0)},register:e=>{this.getMapEventElement().addEventListener("contextmenu",e)},unregister:e=>{this.getMapEventElement().removeEventListener("contextmenu",e)}}),new eK({name:"pointerup",callback:e=>{if(!this._currentModeCallbacks||e.target!==this.getMapEventElement()||this._ignoreMismatchedPointerEvents&&this._lastPointerDownEventTarget!==e.target||(this._lastPointerDownEventTarget=void 0,!e.isPrimary))return;let t=this.getDrawEventFromEvent(e);t&&("dragging"===this._dragState?this._currentModeCallbacks.onDragEnd(t,e=>{this.setDraggability.bind(this)(e)}):"not-dragging"!==this._dragState&&"pre-dragging"!==this._dragState||(this._nextKeyUpIsContextMenu&&(t.isContextMenu=!0,this._nextKeyUpIsContextMenu=!1),this._currentModeCallbacks.onClick(t)),this._dragState="not-dragging",this.setDraggability(!0))},register:e=>{this.getMapEventElement().addEventListener("pointerup",e)},unregister:e=>{this.getMapEventElement().removeEventListener("pointerup",e)}}),new eK({name:"keyup",callback:e=>{this._currentModeCallbacks&&(this._heldKeys.delete(e.key),this._currentModeCallbacks.onKeyUp({key:e.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>e.preventDefault()}))},register:e=>{this.getMapEventElement().addEventListener("keyup",e)},unregister:e=>{this.getMapEventElement().removeEventListener("keyup",e)}}),new eK({name:"keydown",callback:e=>{this._currentModeCallbacks&&(this._heldKeys.add(e.key),this._currentModeCallbacks.onKeyDown({key:e.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>e.preventDefault()}))},register:e=>{this.getMapEventElement().addEventListener("keydown",e)},unregister:e=>{this.getMapEventElement().removeEventListener("keydown",e)}})]}unregister(){this._listeners.forEach(e=>{e.unregister()}),this.clear(),this._currentModeCallbacks=void 0,this._lastDrawEvent=void 0,this._lastPointerDownEventTarget=void 0,this._nextKeyUpIsContextMenu=!1}constructor(e){this._nextKeyUpIsContextMenu=!1,this._lastPointerDownEventTarget=void 0,this._ignoreMismatchedPointerEvents=!1,this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._ignoreMismatchedPointerEvents="boolean"==typeof e.ignoreMismatchedPointerEvents&&e.ignoreMismatchedPointerEvents,this._minPixelDragDistance="number"==typeof e.minPixelDragDistance?e.minPixelDragDistance:1,this._minPixelDragDistanceSelecting="number"==typeof e.minPixelDragDistanceSelecting?e.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing="number"==typeof e.minPixelDragDistanceDrawing?e.minPixelDragDistanceDrawing:8,this._coordinatePrecision="number"==typeof e.coordinatePrecision?e.coordinatePrecision:9}},getDefaultStyling:()=>({polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0,markerUrl:void 0,markerHeight:void 0,markerWidth:void 0}),SELECT_PROPERTIES:l};class eq{checkEnabled(){if(!this._enabled)throw Error("Terra Draw is not enabled")}getModeStyles(){let e={};return Object.keys(this._modes).forEach(t=>{e[t]=e=>this._instanceSelectMode&&e.properties[l.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(e):this._modes[t].styleFeature.bind(this._modes[t])(e)}),e}featuresAtLocation(e,t){let{lng:i,lat:o}=e,r=t&&void 0!==t.pointerDistance?t.pointerDistance:30,s=!t||void 0===t.ignoreSelectFeatures||t.ignoreSelectFeatures,n=!(!t||void 0===t.ignoreCoordinatePoints)&&t.ignoreCoordinatePoints,a=!(!t||void 0===t.ignoreCurrentlyDrawing)&&t.ignoreCurrentlyDrawing,c=!(!t||void 0===t.ignoreClosingPoints)&&t.ignoreClosingPoints,h=!(!t||void 0===t.ignoreSnappingPoints)&&t.ignoreSnappingPoints,u=this._adapter.unproject.bind(this._adapter),p=this._adapter.project.bind(this._adapter),g=p(i,o),m=A({unproject:u,point:g,pointerDistance:r});return this._store.search(m).filter(e=>{if(s&&(e.properties[l.MID_POINT]||e.properties[l.SELECTION_POINT])||n&&e.properties[d.COORDINATE_POINT]||c&&e.properties[d.CLOSING_POINT]||a&&e.properties[d.CURRENTLY_DRAWING]||h&&e.properties[d.SNAPPING_POINT])return!1;if("Point"===e.geometry.type){let t=e.geometry.coordinates;return N(g,p(t[0],t[1]))<r}if("LineString"===e.geometry.type){let t=e.geometry.coordinates;for(let e=0;e<t.length-1;e++){let i=t[e],o=t[e+1];if(ey(g,p(i[0],i[1]),p(o[0],o[1]))<r)return!0}return!1}if(em([i,o],e.geometry.coordinates))return!0;if(null!=t&&t.includePolygonsWithinPointerDistance)for(let t of e.geometry.coordinates)for(let e=0;e<t.length-1;e++){let i=t[e],o=t[e+1];if(ey(g,p(i[0],i[1]),p(o[0],o[1]))<r)return!0}return!1}).map(e=>{let r;if(null==t||!t.addClosestCoordinateInfoToProperties)return e;if("Polygon"===e.geometry.type)r=e.geometry.coordinates[0].slice(0,-1);else{if("LineString"!==e.geometry.type)return e;r=e.geometry.coordinates}let s,n=-1,a=1/0;for(let e=0;e<r.length;e++){let t=r[e],i=N(p(t[0],t[1]),g);i<a&&(n=e,a=i,s=t)}return e.properties.closestCoordinateIndexToEvent=n,e.properties.closestCoordinatePixelDistanceToEvent=a,e.properties.closestCoordinateDistanceKmToEvent=y(s,[i,o]),e})}getSelectModeOrThrow(){let e=this.getSelectMode({switchToSelectMode:!0});if(!e)throw Error("No select mode defined in instance");return e}getSelectMode(e){let{switchToSelectMode:t}=e;if(this.checkEnabled(),!this._instanceSelectMode)return null;let i=this.getMode();return t&&i!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}isGuidanceFeature(e){return!!(e.properties[l.MID_POINT]||e.properties[l.SELECTION_POINT]||e.properties[d.COORDINATE_POINT]||e.properties[d.SNAPPING_POINT])}setModeStyles(e,t){if(this.checkEnabled(),!this._modes[e])throw Error("No mode with this name present");this._modes[e].styles=t}updateModeOptions(e,t){if(this.checkEnabled(),!this._modes[e])throw Error("No mode with this name present");this._modes[e].updateOptions(t)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw Error("Enabled is read only")}getMode(){return this._mode.mode}getModeState(){return this._mode.state}setMode(e){if(this.checkEnabled(),!this._modes[e])throw Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled();let t=[];e.forEach(e=>{if(!this._store.has(e))throw Error("No feature with id ".concat(e,", can not delete"));let i=this._store.copy(e);i.properties[l.SELECTED]&&this.deselectFeature(e),i.properties[d.COORDINATE_POINT_IDS]&&t.push(...i.properties[d.COORDINATE_POINT_IDS])}),this._store.delete([...e,...t],{origin:"api"})}selectFeature(e){this.getSelectModeOrThrow().selectFeature(e)}deselectFeature(e){this.getSelectModeOrThrow().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}checkIsReservedProperty(e){return![...Object.values(l),...Object.values(d)].includes(e)}updateFeatureProperties(e,t){if(!this._store.has(e))throw Error("No feature with id ".concat(e," present in store"));let i=this._store.copy(e);if(this.isGuidanceFeature(i))throw Error("Guidance features are not allowed to be updated directly.");let o=i.properties.mode;if(!this._modes[o])throw Error("No mode with name ".concat(o," present in instance"));let r=Object.entries(t);r.forEach(e=>{let[t,i]=e;if(!this.checkIsReservedProperty(t))throw Error("You are trying to update a reserved property name: ".concat(t,". Please choose another name."));if(void 0!==i&&!function e(t){if(null===t||"boolean"==typeof t||"string"==typeof t)return!0;if(void 0===t)return!1;if("number"==typeof t)return Number.isFinite(t);if("bigint"==typeof t||"symbol"==typeof t||"function"==typeof t||t instanceof RegExp||t instanceof Map||t instanceof Set||t instanceof Date)return!1;if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.getPrototypeOf(t);if(e!==Object.prototype&&null!==e)return!1}if(ArrayBuffer.isView(t)&&!(t instanceof DataView))return!1;if(Array.isArray(t)){for(let i of t)if(!e(i))return!1}return"object"==typeof t&&Object.keys(t).every(i=>"string"==typeof i&&e(t[i]))}(i))throw Error("Invalid JSON value provided for property ".concat(t))}),this._store.updateProperty(r.map(e=>{let[t,o]=e;return{id:i.id,property:t,value:o}}),{origin:"api"})}updateFeatureGeometry(e,t){if(!this._store.has(e))throw Error("No feature with id ".concat(e," present in store"));let i=this._store.copy(e);if(this.isGuidanceFeature(i))throw Error("Guidance features are not allowed to be updated directly.");if(!(i&&t&&t.type&&t.coordinates))throw Error("Invalid geometry provided");if(t.type!==i.geometry.type)throw Error("Geometry type mismatch: expected ".concat(i.geometry.type,", got ").concat(t.type));let o=i.properties.mode,r=this._modes[o];if(!r)throw Error("No mode with name ".concat(o," present in instance"));let s=a({},i,{geometry:t}),n=r.validateFeature(s);if(!n.valid)throw Error("Feature validation failed: ".concat(n.reason||"Unknown reason"));if(this._store.updateGeometry([{id:i.id,geometry:t}],{origin:"api"}),r.afterFeatureUpdated){r.afterFeatureUpdated(s);let e=s.properties[l.SELECTED],t=this.getSelectMode({switchToSelectMode:!1});t&&e&&t.afterFeatureUpdated(s)}}transformFeatureGeometry(e,t){let i;if(!this._store.has(e))throw Error("No feature with id ".concat(e," present in store"));let o=this._store.copy(e);if(this.isGuidanceFeature(o))throw Error("Guidance features are not allowed to be updated directly.");let r=o.properties.mode,s=this._modes[r];if(!s)throw Error("No mode with name ".concat(r," present in instance"));if("Polygon"===o.geometry.type)i=o.geometry.coordinates[0];else{if("LineString"!==o.geometry.type)throw Error("Feature geometry type ".concat(o.geometry.type," is not supported for transformation"));i=o.geometry.coordinates}if("web-mercator"!=t.projection)throw Error("Projection ".concat(t.projection," is not currently supported for transformation"));if("scale"===t.type){let{x:e,y:o}=C(t.origin[0],t.origin[1]);ew({coordinates:i,originX:e,originY:o,xScale:t.options.xScale||1,yScale:t.options.yScale||1})}else"rotate"===t.type&&(i="Polygon"===(o=eP(o,t.options.angle||0)).geometry.type?o.geometry.coordinates[0]:o.geometry.coordinates);if(i=i.map(e=>[x(e[0],this._adapter.getCoordinatePrecision()),x(e[1],this._adapter.getCoordinatePrecision())]),o.geometry.coordinates="Polygon"===o.geometry.type?[i]:i,this._store.updateGeometry([{id:o.id,geometry:o.geometry}],{origin:"api"}),s.afterFeatureUpdated){s.afterFeatureUpdated(o);let e=o.properties[l.SELECTED],t=this.getSelectMode({switchToSelectMode:!1});t&&e&&t.afterFeatureUpdated(o)}}addFeatures(e){return this.checkEnabled(),0===e.length?[]:this._store.load(e,e=>{if(h(e)){let t=e.properties.mode,i=this._modes[t];if(!i)return{id:e.id,valid:!1,reason:"".concat(t," mode is not in the list of instantiated modes")};let o=i.validateFeature.bind(i)(e);return{id:e.id,valid:o.valid,reason:o.reason?o.reason:o.valid?void 0:"Feature is invalid"}}return{id:e.id,valid:!1,reason:"Mode property does not exist"}},e=>{if(h(e)){let t=this._modes[e.properties.mode];t&&t.afterFeatureAdded&&t.afterFeatureAdded(e)}},{origin:"api"})}start(){this._enabled||(this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,t)=>{this._mode.onDragStart(e,t)},onDrag:(e,t)=>{this._mode.onDrag(e,t)},onDragEnd:(e,t)=>{this._mode.onDragEnd(e,t)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}}))}getFeaturesAtLngLat(e,t){let{lng:i,lat:o}=e;return this.featuresAtLocation({lng:i,lat:o},t)}getFeaturesAtPointerEvent(e,t){let i=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return null===i?[]:this.featuresAtLocation(i,t)}stop(){this._enabled&&(this._enabled=!1,this._adapter.unregister())}on(e,t){let i=this._eventListeners[e];i.includes(t)||i.push(t)}off(e,t){let i=this._eventListeners[e];i.includes(t)&&i.splice(i.indexOf(t),1)}constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new eD;let t=new Set,o=e.modes.reduce((e,i)=>{if(t.has(i.mode))throw Error("There is already a ".concat(i.mode," mode provided"));return t.add(i.mode),e[i.mode]=i,e},{}),r=Object.keys(o);if(0===r.length)throw Error("No modes provided");r.forEach(e=>{if(o[e].type===i.Select){if(this._instanceSelectMode)throw Error("only one type of select mode can be provided");this._instanceSelectMode=e}}),this._modes=a({},o,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new eX({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});let s=e=>{let t=[],i=this._store.copyAll().filter(i=>!e.includes(i.id)||(t.push(i),!1));return{changed:t,unchanged:i}},n=(e,t)=>{this._enabled&&this._eventListeners.finish.forEach(i=>{i(e,t)})},l=(e,t,i)=>{if(!this._enabled)return;this._eventListeners.change.forEach(o=>{o(e,t,i)});let{changed:o,unchanged:r}=s(e);"create"===t?this._adapter.render({created:o,deletedIds:[],unchanged:r,updated:[]},this.getModeStyles()):"update"===t?this._adapter.render({created:[],deletedIds:[],unchanged:r,updated:o},this.getModeStyles()):"delete"===t?this._adapter.render({created:[],deletedIds:e,unchanged:r,updated:[]},this.getModeStyles()):"styling"===t&&this._adapter.render({created:[],deletedIds:[],unchanged:r,updated:[]},this.getModeStyles())},d=e=>{if(!this._enabled)return;this._eventListeners.select.forEach(t=>{t(e)});let{changed:t,unchanged:i}=s([e]);this._adapter.render({created:[],deletedIds:[],unchanged:i,updated:t},this.getModeStyles())},c=e=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(e=>{e()});let{changed:t,unchanged:i}=s([e]);t&&this._adapter.render({created:[],deletedIds:[],unchanged:i,updated:t},this.getModeStyles())};Object.keys(this._modes).forEach(e=>{this._modes[e].register({mode:e,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:l,onSelect:d,onDeselect:c,onFinish:n,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}}class eZ extends eH.TerraDrawBaseAdapter{get _layers(){var e;return(null==(e=this.renderedFeatureIds)?void 0:e.size)>0}circlePath(e,t,i){let o=2*i;return"M ".concat(e," ").concat(t," m -").concat(i,", 0 a ").concat(i,",").concat(i," 0 1,0 ").concat(o,",0 a ").concat(i,",").concat(i," 0 1,0 -").concat(o,",0")}register(e){super.register(e),this._overlay=new this._lib.OverlayView,this._overlay.draw=function(){},this._overlay.onAdd=()=>{var e;null!=(e=this._currentModeCallbacks)&&e.onReady&&!this._readyCalled&&(this._currentModeCallbacks.onReady(),this._readyCalled=!0)},this._overlay.setMap(this._map),this._overlay.onRemove=()=>{},this._clickEventListener=this._map.data.addListener("click",e=>{let t=this._listeners.find(e=>{let{name:t}=e;return"click"===t});t&&t.callback(e)}),this._mouseMoveEventListener=this._map.data.addListener("mousemove",e=>{let t=this._listeners.find(e=>{let{name:t}=e;return"mousemove"===t});t&&t.callback(e)})}unregister(){var e,t;super.unregister(),null==(e=this._clickEventListener)||e.remove(),null==(t=this._mouseMoveEventListener)||t.remove(),this._overlay&&this._overlay.getMap()&&this._overlay.setMap(null),this._overlay=void 0,this._readyCalled=!1}getLngLatFromEvent(e){if(!this._overlay)throw Error("cannot get overlay");let t=this._map.getBounds();if(!t)return null;let i=t.getNorthEast(),o=t.getSouthWest(),r=new this._lib.LatLngBounds(o,i),s=this._map.getDiv(),n=e.clientX-s.getBoundingClientRect().left,a=e.clientY-s.getBoundingClientRect().top,l=new this._lib.Point(n,a),d=this._overlay.getProjection();if(!d)return null;let c=d.fromContainerPixelToLatLng(l);return c&&r.contains(c)?{lng:c.lng(),lat:c.lat()}:null}getMapEventElement(){return this._map.getDiv().querySelector('div[style*="z-index: 3;"]')}project(e,t){if(!this._overlay)throw Error("cannot get overlay");if(void 0===this._map.getBounds())throw Error("cannot get bounds");let i=this._overlay.getProjection();if(void 0===i)throw Error("cannot get projection");let o=i.fromLatLngToContainerPixel(new this._lib.LatLng(t,e));if(null===o)throw Error("cannot project coordinates");return{x:o.x,y:o.y}}unproject(e,t){if(!this._overlay)throw Error("cannot get overlay");let i=this._overlay.getProjection();if(void 0===i)throw Error("cannot get projection");let o=i.fromContainerPixelToLatLng(new this._lib.Point(e,t));if(null===o)throw Error("cannot unproject coordinates");return{lng:o.lng(),lat:o.lat()}}setCursor(e){if(e!==this._cursor){if(this._cursorStyleSheet&&(this._cursorStyleSheet.remove(),this._cursorStyleSheet=void 0),"unset"!==e){let t=this._map.getDiv().querySelector(".gm-style > div");if(t){t.classList.add("terra-draw-google-maps");let i=document.createElement("style");i.innerHTML=".terra-draw-google-maps { cursor: ".concat(e," !important; }"),document.getElementsByTagName("head")[0].appendChild(i),this._cursorStyleSheet=i}}this._cursor=e}}setDoubleClickToZoom(e){this._map.setOptions(e?{disableDoubleClickZoom:!1}:{disableDoubleClickZoom:!0})}setDraggability(e){this._map.setOptions({draggable:e})}render(e,t){this._layers&&(e.deletedIds.forEach(e=>{let t=this._map.data.getFeatureById(e);t&&(this._map.data.remove(t),this.renderedFeatureIds.delete(e))}),e.updated.forEach(e=>{if(!e||!e.id)throw Error("Feature is not valid");let t=this._map.data.getFeatureById(e.id);if(!t)throw Error("Feature could not be found by Google Maps API");switch(t.forEachProperty((e,i)=>{t.setProperty(i,void 0)}),Object.keys(e.properties).forEach(i=>{t.setProperty(i,e.properties[i])}),e.geometry.type){case"Point":{let i=e.geometry.coordinates;t.setGeometry(new this._lib.Data.Point(new this._lib.LatLng(i[1],i[0])))}break;case"LineString":{let i=e.geometry.coordinates,o=[];for(let e=0;e<i.length;e++){let t=i[e],r=new this._lib.LatLng(t[1],t[0]);o.push(r)}t.setGeometry(new this._lib.Data.LineString(o))}break;case"Polygon":{let i=e.geometry.coordinates,o=[];for(let e=0;e<i.length;e++){let t=[];for(let o=0;o<i[e].length;o++){let r=new this._lib.LatLng(i[e][o][1],i[e][o][0]);t.push(r)}o.push(t)}t.setGeometry(new this._lib.Data.Polygon(o))}}}),e.created.forEach(e=>{this.renderedFeatureIds.add(e.id),this._map.data.addGeoJson(e)})),e.created.forEach(e=>{this.renderedFeatureIds.add(e.id)});let i={type:"FeatureCollection",features:[...e.created]};this._map.data.addGeoJson(i),this._map.data.setStyle(e=>{let i=e.getProperty("mode"),o=e.getGeometry();if(!o)throw Error("Google Maps geometry not found");let r=o.getType(),s={},n=e.getId();e.forEachProperty((e,t)=>{s[t]=e});let a=t[i]({type:"Feature",id:n,geometry:{type:r,coordinates:[]},properties:s});switch(r){case"Point":return a.markerUrl?{clickable:!1,icon:{url:a.markerUrl,scaledSize:a.markerWidth&&a.markerHeight?new this._lib.Size(a.markerWidth,a.markerHeight):void 0},zIndex:a.zIndex}:{clickable:!1,icon:{path:this.circlePath(0,0,a.pointWidth),fillColor:a.pointColor,fillOpacity:1,strokeColor:a.pointOutlineColor,strokeWeight:a.pointOutlineWidth,rotation:0,scale:1},zIndex:a.zIndex};case"LineString":return{strokeColor:a.lineStringColor,strokeWeight:a.lineStringWidth,zIndex:a.zIndex};case"Polygon":return{strokeColor:a.polygonOutlineColor,strokeWeight:a.polygonOutlineWidth,fillOpacity:a.polygonFillOpacity,fillColor:a.polygonFillColor,zIndex:a.zIndex}}throw Error("Unknown feature type")})}clearLayers(){this._layers&&(this._map.data.forEach(e=>{let t=e.getId();this.renderedFeatureIds.has(t)&&this._map.data.remove(e)}),this.renderedFeatureIds=new Set)}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())}getCoordinatePrecision(){return super.getCoordinatePrecision()}constructor(e){super(e),this._cursor=void 0,this._cursorStyleSheet=void 0,this._lib=void 0,this._map=void 0,this._overlay=void 0,this._clickEventListener=void 0,this._mouseMoveEventListener=void 0,this._readyCalled=!1,this.renderedFeatureIds=new Set,this._lib=e.lib,this._map=e.map,this._coordinatePrecision="number"==typeof e.coordinatePrecision?e.coordinatePrecision:9}}var eJ=e.i(21334),eQ=e.i(17363);let e$=e=>{let t={...e,type:"Feature"};if(t.geometry&&"string"==typeof t.geometry.coordinates)try{t.geometry.coordinates=JSON.parse(t.geometry.coordinates)}catch(e){console.error("Failed to parse coordinates string:",e)}return t},e0={lat:5.821944,lng:-73.029722},e1=()=>{let e=(0,s.useMap)(),t=(0,n.useMapStore)(e=>e.markers),i=(0,n.useMapStore)(e=>e.setMapInstance),a=(0,n.useMapStore)(e=>e.updateMarker),l=(0,n.useMapStore)(e=>e.updateMapState),d=(0,n.useMapStore)(e=>e.placementActive),c=(0,n.useMapStore)(e=>e.finalizeMarker),h=(0,n.useMapStore)(e=>e.setSidebarVisibility),u=(0,n.useMapStore)(e=>e.setActiveMarker),{draw:p}=function(e){let t=(0,n.useMapStore)(e=>e.draw),i=(0,n.useMapStore)(e=>e.drawings),o=(0,n.useMapStore)(e=>e.activeTool),s=(0,n.useMapStore)(e=>e.setDrawInstance),a=(0,n.useMapStore)(e=>e.updateDrawings),l=(0,n.useMapStore)(e=>e.deleteById),d=(0,n.useMapStore)(e=>e.deleteRequestId),c=(0,n.useMapStore)(e=>e.clearDeleteRequest),h=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{var o;if(!e||!(null==(o=window.google)?void 0:o.maps)||t)return;let r=e.getDiv();if(!r)return void console.error("Map div not available");r.id||(r.id="create_map-id");let n=()=>{if(!e.getProjection()){console.log("Map projection not ready, waiting...");let t=e.addListener("projection_changed",()=>{google.maps.event.removeListener(t),n()});return}try{var t;let o=(t=window.google.maps,new eq({adapter:new eZ({lib:t,map:e}),modes:[new e_({flags:{arbitary:{feature:{}}}}),new en,new ed,new $,new F,new et]}));if(s(o),o.start(),h.current=!0,o.setMode("select"),console.log("TerraDraw initialized and started"),i&&Array.isArray(i)&&i.length>0){console.log("Loading ".concat(i.length," existing drawings..."));let e=i.map(e$);o.addFeatures(e)}let r=(e,t)=>{let i=o.getSnapshot();a(i)};return o.on("change",r),()=>{o.off("change",r)}}catch(e){console.error("Failed to setup TerraDraw:",e)}};return n()},[e,t,s,a]),(0,r.useEffect)(()=>()=>{if(t&&h.current){try{t.stop(),console.log("TerraDraw stopped")}catch(e){console.error("Failed to stop TerraDraw:",e)}h.current=!1,s(null)}},[t]),(0,r.useEffect)(()=>{if(!e||!t||!h.current)return;let i=(null==o?void 0:o.startsWith("DRAW_"))&&"DRAW_SELECT"!==o;try{if(i){let e={DRAW_POLYGON:"polygon",DRAW_RECTANGLE:"rectangle",DRAW_LINESTRING:"linestring",DRAW_CIRCLE:"circle",DRAW_POINT:"point"}[o];e&&(t.setMode(e),console.log("Set mode to:",e))}else t.setMode("select"),console.log("Set mode to: select");e.setOptions({draggable:!i,gestureHandling:i?"none":"cooperative",disableDoubleClickZoom:i});let r=e.getDiv();r&&(r.style.cursor=i?"crosshair":"")}catch(e){console.error("Failed to set drawing mode:",e)}},[e,t,o]),(0,r.useEffect)(()=>{if(t&&d){try{if("selected"===d){var e;let i=(null==(e=t.getSelectedIds)?void 0:e.call(t))||[];i.length&&l(i)}else l(d)}catch(e){console.error("Error handling delete request:",e)}c()}},[d,t,l,c]),{draw:t}}(e);return(0,r.useEffect)(()=>{if(e&&t&&t.length>0){let i=t[0];if(i&&i.position&&i.position.lat&&i.position.lng){let t=new window.google.maps.LatLng(i.position.lat,i.position.lng);e.setCenter(t),console.log("Map centered on first marker: Lat ".concat(i.position.lat,", Lng ").concat(i.position.lng))}}},[e]),(0,r.useEffect)(()=>{if(!e)return;let t=e.getDiv();t.id||(t.id="create_map-id"),i(e)},[e,i]),(0,r.useEffect)(()=>{if(!e||!d)return;let t=e.addListener("click",e=>{if(!e.latLng)return;let t={lat:e.latLng.lat(),lng:e.latLng.lng()};d&&c(t)});return()=>t.remove()},[e,d,c]),(0,r.useEffect)(()=>{if(!e)return;let t=e.addListener("idle",()=>{let t=e.getCenter(),i=e.getZoom();t&&l({center:{lat:t.lat(),lng:t.lng()},zoom:null!=i?i:16})});return()=>t.remove()},[e,l]),(0,o.jsx)(o.Fragment,{children:t.map(e=>{let t=(0,eJ.getIconComponent)(e.icon);return e.visible?(0,o.jsxs)(s.AdvancedMarker,{onClick:()=>{h("layer",!1),h("marker",!0),u(e.id)},position:e.position,title:e.title,className:"p-2 rounded-4xl border-2",style:{background:e.background,borderColor:e.iconColor,color:e.iconColor},draggable:e.draggable,onDrag:t=>{var i,o;let r=null==(i=t.latLng)?void 0:i.lat(),s=null==(o=t.latLng)?void 0:o.lng();void 0!==r&&void 0!==s&&a(e.id,{position:{lat:r,lng:s}})},children:[(0,o.jsx)(t,{className:"h-7 w-7 cursor-pointer ",style:{color:e.iconColor}}),(0,o.jsx)(eQ.Circle,{center:e.position,radius:e.radius})]},e.id):(0,o.jsx)(o.Fragment,{})})})},e2=e=>{let{useFullPage:t=!1}=e,i=(0,n.useMapStore)(e=>e.center)||e0,r=(0,n.useMapStore)(e=>e.zoom)||16;return(0,o.jsx)("div",{style:{width:"100%",height:t?"100vh":"92.5vh"},children:(0,o.jsx)(s.Map,{id:"create_map",mapId:"create_map_id",defaultCenter:i,defaultZoom:r,gestureHandling:"cooperative",disableDefaultUI:!0,children:(0,o.jsx)(e1,{})})})},e3=()=>{let e=(0,n.useMapStore)(e=>e.center)||e0,t=(0,n.useMapStore)(e=>e.zoom)||16;return(0,o.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,o.jsx)(s.Map,{id:"create_map",mapId:"create_map_id",defaultCenter:e,defaultZoom:t,gestureHandling:"cooperative",disableDefaultUI:!0,children:(0,o.jsx)(e1,{})})})}}]);